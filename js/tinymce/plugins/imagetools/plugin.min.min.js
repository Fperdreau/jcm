!function(){var j={},i=function(a){for(var v=j[a],u=v.deps,t=v.defn,s=u.length,r=new Array(s),q=0;s>q;++q){r[q]=o(u[q])}var d=t.apply(null,r);if(void 0===d){throw"module ["+a+"] returned undefined"}v.instance=d},p=function(a,f,e){if("string"!=typeof a){throw"module id must be a string"}if(void 0===f){throw"no dependencies for "+a}if(void 0===e){throw"no definition function for "+a}j[a]={deps:f,defn:e,instance:void 0}},o=function(b){var a=j[b];if(void 0===a){throw"module ["+b+"] was undefined"}return void 0===a.instance&&i(b),a.instance},n=function(g,d){for(var r=g.length,q=new Array(r),h=0;r>h;++h){q.push(o(g[h]))}d.apply(null,d)},m={};m.bolt={module:{api:{define:p,require:n,demand:o}}};var l=p,k=function(d,c){l(d,[],function(){return c})};k("1",tinymce.PluginManager),k("2",tinymce.Env),k("3",tinymce.util.Promise),k("4",tinymce.util.URI),k("5",tinymce.util.Tools),k("6",tinymce.util.Delay),l("j",[],function(){function e(g,c){return f(document.createElement("canvas"),g,c)}function d(b){return b.getContext("2d")}function f(h,g,q){return h.width=g,h.height=q,h}return{create:e,resize:f,get2dContext:d}}),l("k",[],function(){function d(b){return b.naturalWidth||b.width}function c(b){return b.naturalHeight||b.height}return{getWidth:d,getHeight:c}}),l("l",[],function(){function z(d,c){return function(){d.apply(c,arguments)}}function y(a){if("object"!=typeof this){throw new TypeError("Promises must be constructed via new")}if("function"!=typeof a){throw new TypeError("not a function")}this._state=null,this._value=null,this._deferreds=[],s(a,z(w,this),z(v,this))}function x(d){var c=this;return null===this._state?void this._deferreds.push(d):void r(function(){var f=c._state?d.onFulfilled:d.onRejected;if(null===f){return void (c._state?d.resolve:d.reject)(c._value)}var b;try{b=f(c._value)}catch(a){return void d.reject(a)}d.resolve(b)})}function w(a){try{if(a===this){throw new TypeError("A promise cannot be resolved with itself.")}if(a&&("object"==typeof a||"function"==typeof a)){var e=a.then;if("function"==typeof e){return void s(z(e,a),z(w,this),z(v,this))}}this._state=!0,this._value=a,u.call(this)}catch(d){v.call(this,d)}}function v(b){this._state=!1,this._value=b,u.call(this)}function u(){for(var d=0,c=this._deferreds.length;c>d;d++){x.call(this,this._deferreds[d])}this._deferreds=null}function t(f,e,h,g){this.onFulfilled="function"==typeof f?f:null,this.onRejected="function"==typeof e?e:null,this.resolve=h,this.reject=g}function s(g,f,B){var A=!1;try{g(function(b){A||(A=!0,f(b))},function(b){A||(A=!0,B(b))})}catch(h){if(A){return}A=!0,B(h)}}if(window.Promise){return window.Promise}var r=y.immediateFn||"function"==typeof setImmediate&&setImmediate||function(b){setTimeout(b,1)},q=Array.isArray||function(b){return"[object Array]"===Object.prototype.toString.call(b)};return y.prototype["catch"]=function(b){return this.then(null,b)},y.prototype.then=function(b,f){var c=this;return new y(function(a,d){x.call(c,new t(b,f,a,d))})},y.all=function(){var b=Array.prototype.slice.call(1===arguments.length&&q(arguments[0])?arguments[0]:arguments);return new y(function(a,B){function A(C,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var d=e.then;if("function"==typeof d){return void d.call(e,function(f){A(C,f)},B)}}b[C]=e,0===--h&&a(b)}catch(c){B(c)}}if(0===b.length){return a([])}for(var h=b.length,g=0;g<b.length;g++){A(g,b[g])}})},y.resolve=function(b){return b&&"object"==typeof b&&b.constructor===y?b:new y(function(a){a(b)})},y.reject=function(b){return new y(function(a,d){d(b)})},y.race=function(b){return new y(function(a,h){for(var g=0,f=b.length;f>g;g++){b[g].then(a,h)}})},y}),l("m",[],function(){function d(f){var e=document.createElement("a");return e.href=f,e.pathname}function c(a){var h=d(a).split("."),g=h[h.length-1],f={jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png"};return g&&(g=g.toLowerCase()),f[g]}return{guessMimeType:c}}),l("c",["l","j","m","k"],function(E,D,C,B){function A(a){return new E(function(b){function d(){a.removeEventListener("load",d),b(a)}a.complete?b(a):a.addEventListener("load",d)})}function z(b){return A(b).then(function(d){var g,f;return f=D.create(B.getWidth(d),B.getHeight(d)),g=D.get2dContext(f),g.drawImage(d,0,0),f})}function y(b){return A(b).then(function(d){var c=d.src;return 0===c.indexOf("blob:")?w(c):0===c.indexOf("data:")?v(c):z(d).then(function(e){return v(e.toDataURL(C.guessMimeType(c)))})})}function x(a){return new E(function(b){function f(){e.removeEventListener("load",f),b(e)}var e=new Image;e.addEventListener("load",f),e.src=URL.createObjectURL(a),e.complete&&f()})}function w(a){return new E(function(b){var d=new XMLHttpRequest;d.open("GET",a,!0),d.responseType="blob",d.onload=function(){200==this.status&&b(this.response)},d.send()})}function v(a){return new E(function(b){var K,J,I,H,G,F;if(a=a.split(","),H=/data:([^;]+)/.exec(a[0]),H&&(G=H[1]),K=atob(a[1]),window.WebKitBlobBuilder){for(F=new WebKitBlobBuilder,J=new ArrayBuffer(K.length),I=0;I<J.length;I++){J[I]=K.charCodeAt(I)}return F.append(J),void b(F.getBlob(G))}for(J=new Uint8Array(K.length),I=0;I<J.length;I++){J[I]=K.charCodeAt(I)}b(new Blob([J],{type:G}))})}function u(b){return 0===b.indexOf("blob:")?w(b):0===b.indexOf("data:")?v(b):null}function t(d,c){return v(d.toDataURL(c))}function s(a){return new E(function(b){var d=new FileReader;d.onloadend=function(){b(d.result)},d.readAsDataURL(a)})}function r(b){return s(b).then(function(c){return c.split(",")[1]})}function q(b){URL.revokeObjectURL(b.src)}return{blobToImage:x,imageToBlob:y,blobToDataUri:s,blobToBase64:r,imageToCanvas:z,canvasToBlob:t,revokeImageUrl:q,uriToBlob:u}}),l("n",[],function(){function B(e,d,f){return e=parseFloat(e),e>f?e=f:d>e&&(e=d),e}function A(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}function z(D,C){var J,I,H,G,F=[],E=new Array(10);for(J=0;5>J;J++){for(I=0;5>I;I++){F[I]=C[I+5*J]}for(I=0;5>I;I++){for(G=0,H=0;5>H;H++){G+=D[I+5*H]*F[H]}E[I+5*J]=G}}return E}function y(a,d){return d=B(d,0,1),a.map(function(c,e){return e%6===0?c=1-(1-c)*d:c*=d,B(c,0,1)})}function x(a,f){var c;return f=B(f,-1,1),f*=100,0>f?c=127+f/100*127:(c=f%1,c=0===c?q[f]:q[Math.floor(f)]*(1-c)+q[Math.floor(f)+1]*c,c=127*c+127),z(a,[c/127,0,0,0,0.5*(127-c),0,c/127,0,0,0.5*(127-c),0,0,c/127,0,0.5*(127-c),0,0,0,1,0,0,0,0,0,1])}function w(a,F){var E,D,C,c;return F=B(F,-1,1),E=1+(F>0?3*F:F),D=0.3086,C=0.6094,c=0.082,z(a,[D*(1-E)+E,C*(1-E),c*(1-E),0,0,D*(1-E),C*(1-E)+E,c*(1-E),0,0,D*(1-E),C*(1-E),c*(1-E)+E,0,0,0,0,0,1,0,0,0,0,0,1])}function v(a,G){var F,E,D,C,c;return G=B(G,-180,180)/180*Math.PI,F=Math.cos(G),E=Math.sin(G),D=0.213,C=0.715,c=0.072,z(a,[D+F*(1-D)+E*-D,C+F*-C+E*-C,c+F*-c+E*(1-c),0,0,D+F*-D+0.143*E,C+F*(1-C)+0.14*E,c+F*-c+E*-0.283,0,0,D+F*-D+E*-(1-D),C+F*-C+E*C,c+F*(1-c)+E*c,0,0,0,0,0,1,0,0,0,0,0,1])}function u(a,c){return c=B(255*c,-255,255),z(a,[1,0,0,0,c,0,1,0,0,c,0,0,1,0,c,0,0,0,1,0,0,0,0,0,1])}function t(a,h,g,c){return h=B(h,0,2),g=B(g,0,2),c=B(c,0,2),z(a,[h,0,0,0,0,0,g,0,0,0,0,0,c,0,0,0,0,0,1,0,0,0,0,0,1])}function s(a,c){return c=B(c,0,1),z(a,y([0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0,0,0,0,0,1],c))}function r(a,c){return c=B(c,0,1),z(a,y([0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0,0,0,1,0,0,0,0,0,1],c))}var q=[0,0.01,0.02,0.04,0.05,0.06,0.07,0.08,0.1,0.11,0.12,0.14,0.15,0.16,0.17,0.18,0.2,0.21,0.22,0.24,0.25,0.27,0.28,0.3,0.32,0.34,0.36,0.38,0.4,0.42,0.44,0.46,0.48,0.5,0.53,0.56,0.59,0.62,0.65,0.68,0.71,0.74,0.77,0.8,0.83,0.86,0.89,0.92,0.95,0.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];return{identity:A,adjust:y,multiply:z,adjustContrast:x,adjustBrightness:u,adjustSaturation:w,adjustHue:v,adjustColors:t,adjustSepia:s,adjustGrayscale:r}}),l("a",["j","k","c","n"],function(A,z,y,x){function w(b,a){return y.blobToImage(b).then(function(D){function C(af,ae){var ad,ac,ab,aa,Z,Y=af.data,X=ae[0],W=ae[1],V=ae[2],U=ae[3],T=ae[4],S=ae[5],R=ae[6],Q=ae[7],O=ae[8],M=ae[9],L=ae[10],K=ae[11],J=ae[12],I=ae[13],H=ae[14],G=ae[15],F=ae[16],E=ae[17],P=ae[18],N=ae[19];for(Z=0;Z<Y.length;Z+=4){ad=Y[Z],ac=Y[Z+1],ab=Y[Z+2],aa=Y[Z+3],Y[Z]=ad*X+ac*W+ab*V+aa*U+T,Y[Z+1]=ad*S+ac*R+ab*Q+aa*O+M,Y[Z+2]=ad*L+ac*K+ab*J+aa*I+H,Y[Z+3]=ad*G+ac*F+ab*E+aa*P+N}return af}var B,e=A.create(z.getWidth(D),z.getHeight(D)),c=A.get2dContext(e);return c.drawImage(D,0,0),q(D),B=C(c.getImageData(0,0,e.width,e.height),a),c.putImageData(B,0,0),y.canvasToBlob(e)})}function v(b,a){return y.blobToImage(b).then(function(E){function D(Z,Y,X){function W(f,d,g){return f>g?f=g:d>f&&(f=d),f}var V,U,T,S,R,Q,P,O,N,M,L,K,J,I,H,G,F;for(T=Math.round(Math.sqrt(X.length)),S=Math.floor(T/2),V=Z.data,U=Y.data,G=Z.width,F=Z.height,Q=0;F>Q;Q++){for(R=0;G>R;R++){for(P=O=N=0,L=0;T>L;L++){for(M=0;T>M;M++){K=W(R+M-S,0,G-1),J=W(Q+L-S,0,F-1),I=4*(J*G+K),H=X[L*T+M],P+=V[I]*H,O+=V[I+1]*H,N+=V[I+2]*H}}I=4*(Q*G+R),U[I]=W(P,0,255),U[I+1]=W(O,0,255),U[I+2]=W(N,0,255)}}return Y}var C,B,e=A.create(z.getWidth(E),z.getHeight(E)),c=A.get2dContext(e);return c.drawImage(E,0,0),q(E),C=c.getImageData(0,0,e.width,e.height),B=c.getImageData(0,0,e.width,e.height),B=D(C,B,a),c.putImageData(B,0,0),y.canvasToBlob(e)})}function u(a){return function(c,b){return y.blobToImage(c).then(function(F){function E(g,e){var G,h=g.data;for(G=0;G<h.length;G+=4){h[G]=e[h[G]],h[G+1]=e[h[G+1]],h[G+2]=e[h[G+2]]}return g}var D,C,B=A.create(z.getWidth(F),z.getHeight(F)),f=A.get2dContext(B),d=new Array(256);for(C=0;C<d.length;C++){d[C]=a(C,b)}return f.drawImage(F,0,0),q(F),D=E(f.getImageData(0,0,B.width,B.height),d),f.putImageData(D,0,0),y.canvasToBlob(B)})}}function t(b){return function(a,d){return w(a,b(x.identity(),d))}}function s(b){return function(a){return w(a,b)}}function r(b){return function(a){return v(a,b)}}var q=y.revokeImageUrl;return{invert:s([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:t(x.adjustBrightness),hue:t(x.adjustHue),saturate:t(x.adjustSaturation),contrast:t(x.adjustContrast),grayscale:t(x.adjustGrayscale),sepia:t(x.adjustSepia),colorize:function(e,d,h,g){return w(e,x.adjustColors(x.identity(),d,h,g))},sharpen:r([0,-1,0,-1,5,-1,0,-1,0]),emboss:r([-2,-1,0,-1,1,1,0,1,2]),gamma:u(function(d,c){return 255*Math.pow(d/255,1-c)}),exposure:u(function(d,c){return 255*(1-Math.exp(-(d/255)*c))}),colorFilter:w,convoluteFilter:v}}),l("b",["c","j","k"],function(r,q,x){function w(b,a){return r.blobToImage(b).then(function(y){var h=q.create(x.getWidth(y),x.getHeight(y)),e=q.get2dContext(h),d=0,c=0;return a=0>a?360+a:a,90!=a&&270!=a||q.resize(h,h.height,h.width),90!=a&&180!=a||(d=h.width),270!=a&&180!=a||(c=h.height),e.translate(d,c),e.rotate(a*Math.PI/180),e.drawImage(y,0,0),s(y),r.canvasToBlob(h,b.type)})}function v(b,a){return r.blobToImage(b).then(function(h){var e=q.create(x.getWidth(h),x.getHeight(h)),c=q.get2dContext(e);return"v"==a?(c.scale(1,-1),c.drawImage(h,0,-e.height)):(c.scale(-1,1),c.drawImage(h,-e.width,0)),s(h),r.canvasToBlob(e)})}function u(z,y,h,b,a){return r.blobToImage(z).then(function(f){var e=q.create(b,a),d=q.get2dContext(e);return d.drawImage(f,-y,-h),s(f),r.canvasToBlob(e)})}function t(f,b,a){return r.blobToImage(f).then(function(e){var d=q.create(b,a),c=q.get2dContext(d);return c.drawImage(e,0,0,b,a),s(e),r.canvasToBlob(d,f.type)})}var s=r.revokeImageUrl;return{rotate:w,flip:v,crop:u,resize:t}}),l("7",["a","b"],function(J,I){var H=function(a){return J.invert(a)},G=function(a){return J.sharpen(a)},F=function(a){return J.emboss(a)},E=function(a,d){return J.gamma(a,d)},D=function(a,d){return J.exposure(a,d)},C=function(a,h,g,f){return J.colorize(a,h,g,f)},B=function(a,d){return J.brightness(a,d)},A=function(a,d){return J.hue(a,d)},z=function(a,d){return J.saturate(a,d)},y=function(a,d){return J.contrast(a,d)},x=function(a,d){return J.grayscale(a,d)},w=function(a,d){return J.sepia(a,d)},v=function(b,d){return I.flip(b,d)},u=function(b,r,q,h,g){return I.crop(b,r,q,h,g)},t=function(b,f,e){return I.resize(b,f,e)},s=function(b,d){return I.rotate(b,d)};return{invert:H,sharpen:G,emboss:F,brightness:B,hue:A,saturate:z,contrast:y,grayscale:x,sepia:w,colorize:C,gamma:E,exposure:D,flip:v,crop:u,resize:t,rotate:s}}),l("8",["c"],function(g){var f=function(a){return g.blobToImage(a)},r=function(a){return g.imageToBlob(a)},q=function(a){return g.blobToDataUri(a)},h=function(a){return g.blobToBase64(a)};return{blobToImage:f,imageToBlob:r,blobToDataUri:q,blobToBase64:h}}),k("d",tinymce.dom.DOMUtils),k("e",tinymce.ui.Factory),k("f",tinymce.ui.Form),k("g",tinymce.ui.Container),k("o",tinymce.ui.Control),k("p",tinymce.ui.DragHelper),k("q",tinymce.geom.Rect),k("s",tinymce.dom.DomQuery),k("t",tinymce.util.Observable),l("r",["s","p","q","5","t"],function(h,g,t,s,r){var q=0;return function(P,O,N,M){function L(v,u){return{x:u.x+v.x,y:u.y+v.y,w:u.w,h:u.h}}function K(v,u){return{x:u.x-v.x,y:u.y-v.y,w:u.w,h:u.h}}function J(){return K(N,P)}function I(){function u(v){var w;return new g(F,{document:M.ownerDocument,handle:F+"-"+v.name,start:function(){w=P},drag:function(x){var R,Q,A,z,y;R=w.x,Q=w.y,A=w.w,z=w.h,R+=x.deltaX*v.deltaX,Q+=x.deltaY*v.deltaY,A+=x.deltaX*v.deltaW,z+=x.deltaY*v.deltaH,20>A&&(A=20),20>z&&(z=20),y=P=t.clamp({x:R,y:Q,w:A,h:z},N,"move"==v.name),y=K(N,y),e.fire("updateRect",{rect:y}),C(y)}})}h('<div id="'+F+'" class="'+a+'croprect-container" data-mce-bogus="all">').appendTo(M),s.each(b,function(v){h("#"+F,M).append('<div id="'+F+"-"+v+'"class="'+a+'croprect-block" style="display: none" data-mce-bogus="all">')}),s.each(d,function(v){h("#"+F,M).append('<div id="'+F+"-"+v.name+'" class="'+a+"croprect-handle "+a+"croprect-handle-"+v.name+'" style="display: none" data-mce-bogus="all">')}),c=s.map(d,u),G(P)}function H(u){var v;v=s.map(d,function(w){return"#"+F+"-"+w.name}).concat(s.map(b,function(w){return"#"+F+"-"+w})).join(","),u?h(v,M).show():h(v,M).hide()}function G(u){function v(w,x){x.h<0&&(x.h=0),x.w<0&&(x.w=0),h("#"+F+"-"+w,M).css({left:x.x,top:x.y,width:x.w,height:x.h})}s.each(d,function(w){h("#"+F+"-"+w.name,M).css({left:u.w*w.xMul+u.x,top:u.h*w.yMul+u.y})}),v("top",{x:O.x,y:O.y,w:O.w,h:u.y-O.y}),v("right",{x:u.x+u.w,y:u.y,w:O.w-u.x-u.w+O.x,h:u.h}),v("bottom",{x:O.x,y:u.y+u.h,w:O.w,h:O.h-u.y-u.h+O.y}),v("left",{x:O.x,y:u.y,w:u.x-O.x,h:u.h}),v("move",u)}function E(u){P=u,G(P)}function D(u){O=u,G(P)}function C(u){E(L(N,u))}function B(u){N=u,G(P)}function f(){s.each(c,function(u){u.destroy()}),c=[]}var e,d,c,b,a="mce-",F=a+"crid-"+q++;return d=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1}],b=["top","right","bottom","left"],I(M),e=s.extend({toggleVisibility:H,setClampRect:B,setRect:E,getInnerRect:J,setInnerRect:C,setViewPortRect:D,destroy:f},r)}}),l("h",["o","p","q","5","3","r"],function(q,h,v,u,t,s){function r(b){return new t(function(a){function d(){b.removeEventListener("load",d),a(b)}b.complete?a(b):b.addEventListener("load",d)})}return q.extend({Defaults:{classes:"imagepanel"},selection:function(b){return arguments.length?(this.state.set("rect",b),this):this.state.get("rect")},imageSize:function(){var b=this.state.get("viewRect");return{w:b.w,h:b.h}},toggleCropRect:function(b){this.state.set("cropEnabled",b)},imageSrc:function(e){var c=this,f=new Image;f.src=e,r(f).then(function(){var b,g,d=c.state.get("viewRect");g=c.$el.find("img"),g[0]?g.replaceWith(f):c.getEl().appendChild(f),b={x:0,y:0,w:f.naturalWidth,h:f.naturalHeight},c.state.set("viewRect",b),c.state.set("rect",v.inflate(b,-20,-20)),d&&d.w==b.w&&d.h==b.h||c.zoomFit(),c.repaintImage(),c.fire("load")})},zoom:function(b){return arguments.length?(this.state.set("zoom",b),this):this.state.get("zoom")},postRender:function(){return this.imageSrc(this.settings.imageSrc),this._super()},zoomFit:function(){var x,w,D,C,B,A,z,y=this;z=10,x=y.$el.find("img"),w=y.getEl().clientWidth,D=y.getEl().clientHeight,C=x[0].naturalWidth,B=x[0].naturalHeight,A=Math.min((w-z)/C,(D-z)/B),A>=1&&(A=1),y.zoom(A)},repaintImage:function(){var F,E,D,C,B,A,z,y,x,w;w=this.getEl(),y=this.zoom(),x=this.state.get("rect"),z=this.$el.find("img"),B=w.offsetWidth,A=w.offsetHeight,D=z[0].naturalWidth*y,C=z[0].naturalHeight*y,F=Math.max(0,B/2-D/2),E=Math.max(0,A/2-C/2),z.css({left:F,top:E,width:D,height:C}),this.cropRect&&(this.cropRect.setRect({x:x.x*y+F,y:x.y*y+E,w:x.w*y,h:x.h*y}),this.cropRect.setClampRect({x:F,y:E,w:D,h:C}),this.cropRect.setViewPortRect({x:0,y:0,w:B,h:A}))},bindStates:function(){function d(b){c.cropRect=new s(b,c.state.get("viewRect"),c.state.get("viewRect"),c.getEl()),c.cropRect.on("updateRect",function(e){var g=e.rect,f=c.zoom();g={x:Math.round(g.x/f),y:Math.round(g.y/f),w:Math.round(g.w/f),h:Math.round(g.h/f)},c.state.set("rect",g)}),c.on("remove",c.cropRect.destroy)}var c=this;c.state.on("change:cropEnabled",function(b){c.cropRect.toggleVisibility(b.value),c.repaintImage()}),c.state.on("change:zoom",function(){c.repaintImage()}),c.state.on("change:rect",function(b){var a=b.value;c.cropRect||d(a),c.cropRect.setRect(a)})}})}),l("i",[],function(){return function(){function q(d){var c;return c=s.splice(++r),s.push(d),{state:d,removed:c}}function h(){return u()?s[--r]:void 0}function v(){return t()?s[++r]:void 0}function u(){return r>0}function t(){return -1!=r&&r<s.length-1}var s=[],r=-1;return{data:s,add:q,undo:h,redo:v,canUndo:u,canRedo:t}}}),l("9",["d","5","3","e","f","g","h","7","8","i"],function(E,D,C,B,A,z,y,x,w,v){function u(b){return{blob:b,url:URL.createObjectURL(b)}}function t(b){b&&URL.revokeObjectURL(b.url)}function s(b){D.each(b,t)}function r(aU,aT,aS){function aR(G){var F,J,I,H;F=al.find("#w")[0],J=al.find("#h")[0],I=parseInt(F.value(),10),H=parseInt(J.value(),10),al.find("#constrain")[0].checked()&&aA&&b&&I&&H&&("w"==G.control.settings.name?(H=Math.round(I*aF),J.value(H)):(I=Math.round(H*aB),F.value(I))),aA=I,b=H}function aQ(c){return Math.round(100*c)+"%"}function aP(){al.find("#undo").disabled(!e.canUndo()),al.find("#redo").disabled(!e.canRedo()),al.statusbar.find("#save").disabled(!e.canUndo())}function aO(){al.find("#undo").disabled(!0),al.find("#redo").disabled(!0)}function aN(c){c&&ae.imageSrc(c.url)}function aM(c){return function(){var F=D.grep(aE,function(G){return G.settings.name!=c});D.each(F,function(G){G.hide()}),c.show()}}function aL(c){ai=u(c),aN(ai)}function aK(c){aU=u(c),aN(aU),s(e.add(aU).removed),aP()}function aJ(){var c=ae.selection();x.crop(aU.blob,c.x,c.y,c.w,c.h).then(function(F){aK(F),aG()})}function aI(F){var c=[].slice.call(arguments,1);return function(){var G=ai||aU;F.apply(this,[G.blob].concat(c)).then(aL)}}function aH(F){var c=[].slice.call(arguments,1);return function(){F.apply(this,[aU.blob].concat(c)).then(aK)}}function aG(){aN(aU),t(ai),aM(ak)(),aP()}function ax(){ai&&(aK(ai.blob),aG())}function aw(){var c=ae.zoom();2>c&&(c+=0.1),ae.zoom(c)}function av(){var c=ae.zoom();c>0.1&&(c-=0.1),ae.zoom(c)}function au(){aU=e.undo(),aN(aU),aP()}function at(){aU=e.redo(),aN(aU),aP()}function ar(){aT(aU.blob),al.close()}function aq(c){return new A({layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:c})}function ap(F,c){return aq([{text:"Back",onclick:aG},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:ax}]).hide().on("show",function(){aO(),c(aU.blob).then(function(H){var G=u(H);aN(G),t(ai),ai=G})})}function ao(F,c,J,I,H){function G(K){c(aU.blob,K).then(function(M){var L=u(M);aN(L),t(ai),ai=L})}return aq([{text:"Back",onclick:aG},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(K){G(K.value)},minValue:I,maxValue:H,value:J,previewFilter:aQ},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:ax}]).hide().on("show",function(){this.find("slider").value(J),aO()})}function an(F,c){function G(){var H,J,I;H=al.find("#r")[0].value(),J=al.find("#g")[0].value(),I=al.find("#b")[0].value(),c(aU.blob,H,J,I).then(function(L){var K=u(L);aN(K),t(ai),ai=K})}return aq([{text:"Back",onclick:aG},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:G,previewFilter:aQ},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:G,previewFilter:aQ},{type:"slider",label:"B",name:"b",minValue:0,value:1,maxValue:2,ondragend:G,previewFilter:aQ},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:ax}]).hide().on("show",function(){al.find("#r,#g,#b").value(1),aO()})}function am(c){c.control.value()===!0&&(aF=b/aA,aB=aA/b)}var al,ak,aj,ai,ah,ag,af,ae,ad,ac,ab,h,g,f,d,aC,aW,ay,aV,aD,az,a,aE,aA,b,aF,aB,e=new v;ah=aq([{text:"Back",onclick:aG},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:aJ}]).hide().on("show hide",function(c){ae.toggleCropRect("show"==c.type)}).on("show",aO),ag=aq([{text:"Back",onclick:aG},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:aR},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:aR},{type:"checkbox",name:"constrain",text:"Constrain proportions",checked:!0,onchange:am},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",function(G){var F=parseInt(al.find("#w").value(),10),H=parseInt(al.find("#h").value(),10);G.preventDefault(),aH(x.resize,F,H)(),aG()}).on("show",aO),af=aq([{text:"Back",onclick:aG},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:aI(x.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:aI(x.flip,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:aI(x.rotate,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:aI(x.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:ax}]).hide().on("show",aO),ab=ap("Invert",x.invert),aV=ap("Sharpen",x.sharpen),aD=ap("Emboss",x.emboss),h=ao("Brightness",x.brightness,0,-1,1),g=ao("Hue",x.hue,180,0,360),f=ao("Saturate",x.saturate,0,-1,1),d=ao("Contrast",x.contrast,0,-1,1),aC=ao("Grayscale",x.grayscale,0,0,1),aW=ao("Sepia",x.sepia,0,0,1),ay=an("Colorize",x.colorize),az=ao("Gamma",x.gamma,0,-1,1),a=ao("Exposure",x.exposure,1,0,2),aj=aq([{text:"Back",onclick:aG},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:aM(g)},{text:"saturate",icon:"saturate",onclick:aM(f)},{text:"sepia",icon:"sepia",onclick:aM(aW)},{text:"emboss",icon:"emboss",onclick:aM(aD)},{text:"exposure",icon:"exposure",onclick:aM(a)},{type:"spacer",flex:1}]).hide(),ak=aq([{tooltip:"Crop",icon:"crop",onclick:aM(ah)},{tooltip:"Resize",icon:"resize2",onclick:aM(ag)},{tooltip:"Orientation",icon:"orientation",onclick:aM(af)},{tooltip:"Brightness",icon:"sun",onclick:aM(h)},{tooltip:"Sharpen",icon:"sharpen",onclick:aM(aV)},{tooltip:"Contrast",icon:"contrast",onclick:aM(d)},{tooltip:"Color levels",icon:"drop",onclick:aM(ay)},{tooltip:"Gamma",icon:"gamma",onclick:aM(az)},{tooltip:"Invert",icon:"invert",onclick:aM(ab)}]),ae=new y({flex:1,imageSrc:aU.url}),ad=new z({layout:"flex",direction:"column",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:au},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:at},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:aw},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:av}]}),ac=new z({type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:[ad,ae]}),aE=[ak,ah,ag,af,aj,ab,h,g,f,d,aC,aW,ay,aV,aD,az,a],al=B.create("window",{layout:"flex",direction:"column",align:"stretch",minWidth:Math.min(E.DOM.getViewPort().w,800),minHeight:Math.min(E.DOM.getViewPort().h,650),title:"Edit image",items:aE.concat([ac]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:ar},{text:"Cancel",onclick:"close"}]}),al.renderTo(document.body).reflow(),al.on("close",function(){aS(),s(e.data),e=null,ai=null}),e.add(aU),aP(),ae.on("load",function(){aA=ae.imageSize().w,b=ae.imageSize().h,aF=b/aA,aB=aA/b,al.find("#w").value(aA),al.find("#h").value(b)})}function q(b){return new C(function(a,d){r(u(b),a,d)})}return{edit:q}}),l("0",["1","2","3","4","5","6","7","8","9"],function(z,y,x,w,v,u,t,s,r){var q=function(aa){function Z(a){function C(D){return D.indexOf("px")==D.length-2}var B,A;return B=a.style.width,A=a.style.height,B||A?C(B)&&C(A)?{w:parseInt(B,10),h:parseInt(A,10)}:null:(B=aa.$(a).attr("width"),A=aa.$(a).attr("height"),B&&A?{w:parseInt(B,10),h:parseInt(A,10)}:null)}function Y(a,C){var B,A;C&&(B=a.style.width,A=a.style.height,(B||A)&&aa.$(a).css({width:C.w,height:C.h}).removeAttr("data-mce-style"),B=a.width,A=a.height,(B||A)&&aa.$(a).attr({width:C.w,height:C.h}))}function X(A){return{w:A.naturalWidth,h:A.naturalHeight}}function W(){return aa.selection.getNode()}function V(){return"imagetools"+e++}function U(a){var A=a.src;return 0===A.indexOf("data:")||0===A.indexOf("blob:")||new w(A).host===aa.documentBaseURI.host}function T(a){return -1!==v.inArray(aa.settings.imagetools_cors_hosts,new w(a.src).host)}function R(){return aa.settings.api_key||aa.settings.imagetools_api_key}function P(A){return new x(function(a){var C,B;C=new XMLHttpRequest,C.onload=function(){a(this.response)},C.open("GET",A,!0),B=R(),B&&(C.setRequestHeader("Content-Type","application/json;charset=UTF-8"),C.setRequestHeader("tiny-api-key",B)),C.responseType="blob",C.send()})}function N(a){var A=a.src;if(T(a)){return P(a.src)}if(!U(a)){if(A=aa.settings.imagetools_proxy,A+=(-1===A.indexOf("?")?"?":"&")+"url="+encodeURIComponent(a.src),R()){return P(A)}a=new Image,a.src=A}return s.imageToBlob(a)}function L(){var a;return a=aa.editorUpload.blobCache.getByUri(W().src),a?a:N(W()).then(function(A){return s.blobToBase64(A).then(function(D){var C=aa.editorUpload.blobCache,B=C.create(V(),A,D);return C.add(B),B})})}function J(){I=u.setEditorTimeout(aa,function(){aa.editorUpload.uploadImagesAuto()},30000)}function h(){clearTimeout(I)}function f(a,A){return s.blobToDataUri(a).then(function(G){var F,E,D,C,B;return B=W(),F=V(),D=aa.editorUpload.blobCache,E=w.parseDataUri(G).data,C=D.create(F,a,E),D.add(C),aa.undoManager.transact(function(){function H(){aa.$(B).off("load",H),aa.nodeChanged(),A?aa.editorUpload.uploadImagesAuto():(h(),J())}aa.$(B).on("load",H),aa.$(B).attr({src:C.blobUri()}).removeAttr("data-mce-src")}),C})}function d(a){return function(){return aa._scanForImages().then(L).then(a).then(f)}}function c(A){return function(){return d(function(a){var B=Z(W());return B&&Y(W(),{w:B.h,h:B.w}),t.rotate(a.blob(),A)})()}}function b(A){return function(){return d(function(a){return t.flip(a.blob(),A)})()}}function S(){var B=W(),A=X(B);B&&N(B).then(r.edit).then(function(a){return new x(function(C){s.blobToImage(a).then(function(E){var D=X(E);A.w==D.w&&A.h==D.h||Z(B)&&Y(B,D),URL.revokeObjectURL(E.src),C(a)})})}).then(function(C){f(C,!0)},function(){})}function Q(){aa.addButton("rotateleft",{title:"Rotate counterclockwise",onclick:c(-90)}),aa.addButton("rotateright",{title:"Rotate clockwise",onclick:c(90)}),aa.addButton("flipv",{title:"Flip vertically",onclick:b("v")}),aa.addButton("fliph",{title:"Flip horizontally",onclick:b("h")}),aa.addButton("editimage",{title:"Edit image",onclick:S}),aa.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"})}function O(){aa.on("NodeChange",function(a){g&&g.src!=a.element.src&&(h(),aa.editorUpload.uploadImagesAuto(),g=void 0),M(a.element)&&(g=a.element)})}function M(a){var A=aa.dom.is(a,"img:not([data-mce-object],[data-mce-placeholder])");return A&&(U(a)||T(a)||aa.settings.imagetools_proxy)}function K(){var a=aa.settings.imagetools_toolbar;a||(a="rotateleft rotateright | flipv fliph | crop editimage imageoptions"),aa.addContextToolbar(M,a)}var I,g,e=0;y.fileApi&&(Q(),K(),O(),aa.addCommand("mceEditImage",S))};return z.add("imagetools",q),function(){}}),o("0")()}();