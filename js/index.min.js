var showpubform=function(b,g,d,c,f,a){if(g===undefined){g=false}if(d===undefined){d="new"}if(c===undefined){c=false}if(f===undefined){f=false}var e={getpubform:g,type:d,date:c,prestype:f,destination:a};var h=function(i){b.html(i).fadeIn(200).find("textarea").html(i.content);tinyMCE.remove();window.tinymce.dom.Event.domLoaded=true;tinymcesetup()};processAjax(b,e,h,"php/form.php");loadCalendarSessions()};var showpostform=function(d){var a=$(".postcontent");var b={post_show:true,postid:d};var c=function(e){var f="<textarea name='content' id='post_content' class='tinymce'>"+e.content+"</textarea>";$(".postcontent").empty().html(e.form).fadeIn(200);$(".post_txtarea").html(f).show();tinyMCE.remove();window.tinymce.dom.Event.domLoaded=true;tinymcesetup()};processAjax(a,b,c,"php/form.php")};function delete_confirmation(b){var d=b.data("params");var a=b.attr("id");b.leanModal();show_section("conf_delete");var c=$(".modal_section#conf_delete");if(c.find('input[name="url"]').length>0){c.find('input[name="url"]').remove()}if(c.find('input[name="el_id"]').length>0){c.find('input[name="el_id"]').remove()}c.append('<input type=hidden name="url" value="'+d+'"/>').append('<input type=hidden name="el_id" value="'+a+'"/>')}function confirmation_box(a,e,f){var b=$(".modalContainer");if(b.find(".modal_section#confirmation_box").length>0){b.find(".modal_section#confirmation_box").remove()}var c="<div class='modal_section' id='confirmation_box' data-title='Confirmation'><div class='sys_msg warning'>"+a+"</div><div class='action_btns'><div class='one_half'><input type='submit' name='cancel' class='pub_back_btn fa-angle-double-left' value='Cancel'></div><div class='one_half last'><input type='submit' name='confirmation' value='"+e+"'></div></div></div>";b.find(".popupBody").append(c);show_section("confirmation_box");var d=$(".modal_section#confirmation_box");d.find("input[name='confirmation']").click(function(){close_modal();f()});d.find("input[name='cancel']").click(function(){close_modal()})}var selected=new Date().getTime();var inititdatepicker=function(a){$("#datepicker").datepicker({defaultDate:selected,firstDay:1,dateFormat:"yy-mm-dd",inline:true,showOtherMonths:true,beforeShowDay:function(b){return renderCalendarCallback(b,a)}})};var initAvailabilityCalendar=function(a){var b=$("#availability_calendar");b.datepicker({defaultDate:selected,onSelect:function(d,c){selected=$(this).datepicker("getDate").getTime();jQuery.ajax({url:"php/form.php",type:"post",data:{update_user_availability:true,date:d},success:function(){loadCalendarAvailability()}})},firstDay:1,dateFormat:"yy-mm-dd",inline:true,showOtherMonths:true,beforeShowDay:function(c){return renderCalendarCallback(c,a)}})};function renderCalendarCallback(b,e){var k=b.getDay();var m=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];var j=$.datepicker.formatDate("dd-mm-yy",b);if(m[k]===e.jc_day){var f="activeday";var n="";var h=$.inArray(j,e.jc_day);var d=e.status[h];var g=(d!=="none");if(h>-1){var i=jcdays.sessiontype[h];var l=jcdays.max_nb_session-jcdays.nb[h];n=i+": ("+l+" presentation(s) available)";if(d==="Free"){f="jcday "+f}else{if(d==="Booked"){f="jcday_rem "+f}else{f="bookedday "+f;n=i+": Booked out"}}f="bookedday "+f}else{f="jcday "+f;n=e.max_nb_session+" presentation(s) available"}var a=$.inArray(j,e.Availability);if(a>-1){f="not_available ";n="Not available"}var c=$.inArray(j,e.Assignments);if(c>-1){f="assigned ";n="You are presenting this day"}return[g,f,n]}else{if(m[k]!==e.jc_day){return[false,"","Not a journal club day"]}}}var logoutTemplate="<div class='logoutWarning'><div class='logout_msg'></div><div class='logout_button'>OK</div></div>";var logout=function(){if(logoutContainer.length==0){$("body").append(logoutTemplate)}login_start=null;login_expire=null;jQuery.ajax({url:"php/form.php",type:"POST",data:{logout:true},async:true,success:function(b){var a=jQuery.parseJSON(b);logoutContainer.find(".logout_msg").html("You have been logged out");logoutContainer.find(".logout_button").html("OK");logoutContainer.fadeIn(200);setTimeout(function(){logoutContainer.fadeOut(200).empty().hide();window.location=a},3000)}})};var login_start=null,login_expire=null,login_warning=null;var logoutContainer=$(".logoutWarning");function check_login(){if(logoutContainer.length==0){$("body").append(logoutTemplate);logoutContainer=$(".logoutWarning")}if(login_start==null){jQuery.ajax({url:"php/form.php",data:{check_login:true},type:"post",async:true,success:function(h){var d=jQuery.parseJSON(h);if(d!==false){login_start=d.start;login_expire=d.expire;login_warning=d.warning}}})}else{var f=Math.floor(new Date().getTime()/1000);var c=login_expire-f;if(c<=login_warning&&c>0){var b=1000*Math.round(c);var g=new Date(b);var e=(g.getUTCMinutes()<10)?"0"+g.getUTCMinutes():g.getUTCMinutes();var a=(g.getUTCSeconds()<10)?"0"+g.getUTCSeconds():g.getUTCSeconds();logoutContainer.find(".logout_msg").html("You will be automatically logged out in "+e+":"+a+" due to inactivity");logoutContainer.find(".logout_button").addClass("extend_session").html("Extend");if(!logoutContainer.is(":visible")){logoutContainer.fadeIn(200)}}else{if(c<0){logout()}}}}function extend_session(){jQuery.ajax({url:"php/form.php",data:{extend_login:true},type:"post",async:true,success:function(b){var a=jQuery.parseJSON(b);if(a!==false){login_start=a.start;login_expire=a.expire;login_warning=a.warning;logoutContainer.hide()}}})}var modalpubform=$(".modal_section#submission_form");var displaypub=function(b,a){b=(b===undefined)?false:b;jQuery.ajax({url:"php/form.php",type:"POST",async:false,data:{show_pub:b},success:function(d){var c=jQuery.parseJSON(d);a.hide().html(c).fadeIn(200);loadCalendarSessions()}})};function realWidth(b){var c=b.clone();c.css("visibility","hidden");$("body").append(c);var a=c.outerWidth();c.remove();return a}function clear_active_submenu(){if($(".submenu").is(":visible")){$(".submenu").hide()}$(".submenu_trigger").each(function(){$(this).parent("li").removeClass("active_submenu")})}function show_submenu(e){var d=e.parent("li");if(d.hasClass("active_submenu")){return true}clear_active_submenu();d.addClass("active_submenu");var b=d.position();var a=d.outerHeight();var f=e.attr("id");var c;if(e.closest("div").hasClass("sideMenu")){c=$(".sideMenu nav.submenu#"+f);c.toggle(200)}else{c=$(".topnav nav.submenu#"+f);c.css({left:b.left+"px",top:b.top+a+"px"}).toggle(200)}}$(document).ready(function(){var a;setInterval(check_login,5000);$("body").on("click","#float_menu",function(){var c=$(this).position();var b=$(this).outerHeight();var d=$(window).height();$(".sideMenu").css({top:b+"px",left:c.left+"px",height:(d-b)+"px","max-height":(d-b)+"px"}).animate({width:"toggle"})}).on("mouseover",".submenu_trigger",function(b){b.preventDefault();show_submenu($(this))}).on("click",".menu-section",function(g){g.preventDefault();g.stopPropagation();var b=$(this).find("a");$(".menu-section").each(function(){$(this).removeClass("activepage")});$(this).addClass("activepage");if(b.is("[id]")){var c=b.attr("href");var f=c.split("&");var j=f[0].split("=");var d=j[1];var i=(b.is("[data-param]"))?b.attr("data-param"):false;getPage(d,i);$(".submenu, .dropdown").hide()}var h=$(".sideMenu");if(h.is(":visible")){h.animate({width:"toggle"})}}).click(function(c){var f=$("nav");var d=$(".sideMenu");var b=$("#float_menu");if(!b.is(c.target)&&b.has(c.target).length===0){if(!f.is(c.target)&&f.has(c.target).length===0){$(".submenu").hide();clear_active_submenu()}if(d.is(":visible")&&!d.is(c.target)&&d.has(c.target).length===0){d.animate({width:"toggle"})}}}).on("mouseenter","#core, .submission",function(b){b.preventDefault()}).on("change","#availability_calendar",function(){alert($(this).val())}).on("click",".change_pwd",function(f){f.preventDefault();var c=$(this).closest("form");var b=$(this).attr("id");var d={change_pw:true,email:b};processAjax(c,d,null,"php/form.php")}).on("click",".conf_changepw",function(f){f.preventDefault();var b=$(this);var c=b.length>0?$(b[0].form):$();if(!checkform(c)){return false}var d=c.serialize();var g=function(e){if(e.status===true){setTimeout(logout,2000)}};processAjax(c,d,g,"php/form.php")}).on("click",".user_select",function(c){c.preventDefault();var b=$(this).data("filter");jQuery.ajax({url:"php/form.php",type:"POST",async:true,data:{user_select:b},success:function(e){var d=jQuery.parseJSON(e);$("#user_list").html(d)}});return false}).on("change",".modify_status",function(d){d.preventDefault();var h=$("#user_list");var g=$(this).attr("data-user");var b=$(this).val();var c={modify_status:true,username:g,option:b};var f=function(e){setTimeout(function(){$("#user_list").html(e.content)},2000)};processAjax(h,c,f,"php/form.php")}).on("click",".test_email_settings",function(f){f.preventDefault();var b=$(this);var c=b.length>0?$(b[0].form):$();var d=c.serializeArray();d.push({name:"test_email_settings",value:true});processAjax(c,d,false,"php/form.php")}).on("click",".add_email",function(g){g.preventDefault();var b=$(".select_emails_selector");var f=b.length>0?$(b[0].form):$();var c=b.find("option:selected").html();var i=b.val();var h=$(".select_emails_container").find(".select_emails_list");$(".select_emails_container").find(".select_emails_list").find(".mailing_recipients_empty").remove();var d=f.find("input[name='emails']");jQuery.ajax({url:"php/form.php",type:"post",data:{add_emails:i},success:function(j){var e=jQuery.parseJSON(j);if(e.status){if(d!==undefined&&d.length>0){var k=d.val().split(",");k.push(e.ids);k=(k[0]==="")?k.slice(1,k.length):k;d.val(k.join(","))}else{f.append("<input name='emails' type='hidden' value='"+e.ids+"'/>")}h.append(e.content)}}})}).on("change",".select_emails_selector",function(g){g.preventDefault();var b=$(this);var f=b.length>0?$(b[0].form):$();var c=b.find("option:selected").html();var i=b.val();var h=$(".select_emails_container").find(".select_emails_list");$(".select_emails_container").find(".select_emails_list").find(".mailing_recipients_empty").remove();var d=f.find("input[name='emails']");if(i==="all"){$("#make_news").find("option[value='yes']").prop("selected",true)}jQuery.ajax({url:"php/form.php",type:"post",data:{add_emails:i},success:function(j){var e=jQuery.parseJSON(j);if(e.status){if(d!==undefined&&d.length>0){var k=d.val().split(",");k.push(e.ids);k=(k[0]==="")?k.slice(1,k.length):k;d.val(k.join(","))}else{f.append("<input name='emails' type='hidden' value='"+e.ids+"'/>")}h.append(e.content)}}})}).on("click",".added_email_delete",function(f){var d=$(this).closest("form");var i=$(this).attr("id");var h=$(".added_email#"+i);var c=d.find("input[name='emails']");var g=c.val().split(",");var b=g.indexOf(i);if(b>-1){g.splice(b,1)}c.val(g.join(","));h.remove()}).on("click",".mailing_send",function(d){d.preventDefault();var c=$(this).length>0?$($(this)[0].form):$();var b=$(".mailing_container");var i=$(".select_emails_container").find(".select_emails_list");i.find(".mailing_recipients_empty").remove();if(!$.trim(i.html()).length){i.html('<p class="mailing_recipients_empty sys_msg warning leanmodal" id="warning">You must select recipients before sending your email!</p>');return true}if(!checkform(c)){return false}var h=function(){var k=c.serializeArray();var j=tinyMCE.get("spec_msg").getContent();var e=[];c.find("input.upl_link").each(function(){e.push($(this).val())});e=e.join(",");k=modArray(k,"body",j);k=modArray(k,"attachments",e);processAjax(b,k,null,"php/form.php")};var g=$(".select_emails_selector").val();if($("#make_news").val()==="yes"){if($(this).data("leanModal")===undefined){$(this).leanModal();$(this).data("leanModal",true);$(this).click()}var f='The option "Add as news" is set to "Yes", which means the content of your email will be published as a news. Do you want to continue?';confirmation_box(f,"Continue",h)}else{h();close_modal()}return true}).on("click",".mail_preview",function(c){c.preventDefault();var b=$(this).attr("id");jQuery.ajax({url:"php/form.php",type:"post",async:true,data:{preview:b},success:function(e){var d=jQuery.parseJSON(e);$(".mail_preview_container").hide().html(d.body).fadeIn(200)}})}).on("change",".select_post",function(b){b.preventDefault();var c=$(this).val();showpostform(c)}).on("click",".edit_post",function(b){b.preventDefault();var c=$(this).closest(".news-details").attr("id");showpostform(c)}).on("click",".post_new",function(b){b.preventDefault();showpostform(false)}).on("click",".post_del",function(c){c.preventDefault();var f=$(this).attr("data-id");var b={post_del:true,postid:f};var d=function(e){if(e.status===true){showpostform(false)}};processAjax($(".postcontent"),b,d,"php/form.php")}).on("click",".submit_post",function(f){f.preventDefault();var c=$(this).closest("#post_form");if(!checkform(c)){return false}var g=function(e){if(e.status===true){c.fadeOut()}};var d=c.serializeArray();var b=tinyMCE.get("post_content").getContent();d=modArray(d,"content",b);processAjax(c,d,g,"php/form.php")}).on("click",".show_log",function(f){f.preventDefault();var c=$(this).closest(".log_container").attr("id");var b=$(this).attr("href");var g=$(".log_content_container#"+c);$(".log_list_item_container").each(function(){$(this).removeClass("log_list_active")});var d=$(this).closest(".log_list_item_container");jQuery.ajax({type:"get",url:b,beforeSend:function(){loadingDiv(g)},complete:function(){removeLoading(g)},success:function(h){var e=jQuery.parseJSON(h);g.html(e);d.addClass("log_list_active")}})}).on("click",".search_log",function(g){g.preventDefault();var b=$(this);var f=b.length>0?$(b[0].form):$();var d=$(this).attr("id");var c=f.attr("action");var h=$(".log_content_container#"+d);jQuery.ajax({type:"get",url:c,data:f.serializeArray(),beforeSend:function(){loadingDiv(h)},complete:function(){removeLoading(h)},success:function(i){var e=jQuery.parseJSON(i);h.html(e)}})}).on("click",".delete_log",function(c){c.preventDefault();var d=$(this).closest(".log_container").parent();var b=$(this).attr("href");jQuery.ajax({type:"get",url:b,beforeSend:function(){loadingDiv(d)},complete:function(){removeLoading(d)},success:function(f){var e=jQuery.parseJSON(f);if(e.status==true){d.html(e.content)}}})}).on("click",".show_log_manager",function(d){d.preventDefault();var c=$(this).attr("id");var f=$(".log_target_container#"+c);var b=$(this).attr("href");if(!f.is(":visible")){jQuery.ajax({type:"get",url:b,beforeSend:function(){loadingDiv(f)},complete:function(){removeLoading(f)},success:function(g){var e=jQuery.parseJSON(g);f.html(e).toggle()}})}else{f.toggle()}}).on("click",".type_add",function(f){f.preventDefault();var d=$(this).attr("data-class");var c=$("input#new_"+d+"_type").val();if($(this).hasClass("wrongField")){$(this).removeClass("wrongField")}if(c.length==0){$(this).siblings("input").addClass("wrongField");return true}var b=$(this);jQuery.ajax({url:"php/form.php",type:"POST",async:true,data:{add_type:d,typename:c},beforeSend:function(){b.toggleClass("addBtn loadBtn")},complete:function(){b.toggleClass("addBtn loadBtn")},success:function(g){var e=jQuery.parseJSON(g);if(e!==false){$(".type_list#"+d).html(e);$("input#new_"+d+"_type").empty()}else{showfeedback("<span class='sys_msg warning'>We could not add this new category","feedback_"+d)}}})}).on("click",".type_del",function(f){f.preventDefault();var c=$(this).attr("data-type");var d=$(this).attr("data-class");var b=$(this);jQuery.ajax({url:"php/form.php",type:"POST",async:true,data:{del_type:d,typename:c},beforeSend:function(){b.addClass("loadBtn")},complete:function(){b.removeClass("loadBtn")},success:function(g){var e=jQuery.parseJSON(g);if(e.status!==false){$(".type_list#"+d).html(e.msg)}else{validsubmitform($(".type_list#"+d),g)}}})}).on("change",".session_type_default",function(d){d.preventDefault();var f=$("#session_type");var b=$(this).val();var c={session_type_default:b};processAjax(f,c,null,"php/form.php")}).on("change",".selectSession",function(f){f.preventDefault();var c=$(this).val();var b=($(this).attr("data-status").length)?$(this).data("status"):"admin";var d={show_session:c,status:b};var h=$("#sessionlist");var g=function(e){$("#sessionlist").html(e).fadeIn(200)};processAjax(h,d,g,"php/form.php")}).on("focus",".modSpeaker",function(){a=$(this).val()}).on("change",".modSpeaker",function(){var d=$(this).val();var b=$(this).closest(".pres_container");var f=b.attr("id");var c=$(this).closest(".session_div").data("id");var e={modSpeaker:d,previous:a,presid:f,date:c};processAjax($(this).closest(".session_div"),e,null,"php/form.php")}).on("change",".mod_session",function(g){g.preventDefault();var h=$(this).attr("name");var d=$(this).val();var b=$(this).closest(".session_div");var f=b.data("id");var c={modSession:true,session:f,prop:h,value:d};processAjax(b,c,null,"php/form.php")}).on("change",".mod_session_type",function(g){g.preventDefault();var h=$(this).attr("name");var d=$(this).val();var b=$(this).closest(".session_div");var f=b.data("id");var c={mod_session_type:true,session:f,prop:h,value:d};processAjax(b,c,null,"php/form.php")}).on("change",".archive_select",function(d){d.preventDefault();var b=$(this).val();var c={select_year:b};var g=function(e){$("#archives_list").html(e)};var f=$("#archives_list");processAjax(f,c,g,"php/form.php")}).on("change","#select_wish",function(d){d.preventDefault();var c=$(this).val();var b=$($(this).data("target"));showpubform(b,c,"edit")}).on("click",".dl_btn",function(){$(".dlmenu").toggle()}).on("click",".link_name",function(){var b=$(this).attr("id");var c="uploads/"+b;window.open(c,"_blank")}).on("change","select#type",function(h){h.preventDefault();var g=$(this).length>0?$($(this)[0].form):$();var f=g.find("#guest");var b=g.find("input[name='title']").parent(".formcontrol");var c=g.find("input[name='authors']").parent(".formcontrol");var d=$(this).val();f.prop("required",false);if(d==="guest"){f.prop("required",true).fadeIn()}else{f.prop("required",false).hide()}if(d=="minute"){b.prop("required",true).hide();c.prop("required",true).hide()}else{b.prop("required",false).fadeIn();c.prop("required",false).fadeIn()}}).on("click",".submit_pres",function(j){j.preventDefault();var g=$(this).attr("name");var d=$(this).length>0?$($(this)[0].form):$();var k=$("select#type").val();if(!checkform(d)){return false}if(g!=="suggest"){var f=$("input#datepicker").val();if((f==="0000-00-00"||f==="")&&k!=="wishlist"){showfeedback('<p id="warning">You must choose a date!</p>');d.find("input#datepicker").focus();return false}}var b=$("input.upl_link");if(b[0]){var m=[];b.each(function(){var e=$(this).val();m.push(e)});m=m.join(",");d.append("<input type='hidden' name='link' value='"+m+"'>")}var h=d.serializeArray();var l=function(e){$("section#submission_form, .modal_section#submission_form").empty();if(e.status===true){close_modal()}};var i=d.find(".tinymce");if(i.length>0&&i!==undefined){i.each(function(){var o=$(this).attr("id");var n=$(this).attr("name");var e=tinyMCE.get(o).getContent();h=modArray(h,n,e)})}var c=$(this).closest(".form_container");processAjax(c,h,l,"php/form.php");j.stopImmediatePropagation()}).on("click","#logout",function(b){b.preventDefault();logout()}).on("click",".logout_button",function(b){$(".logoutWarning").fadeOut(200).toggle()}).on("click",".extend_session",function(b){extend_session()}).on("click","#modal_trigger_pubcontainer",function(c){c.preventDefault();var b=$(this).attr("data-id");displaypub(b,modalpubform)}).on("click","#modal_trigger_pubmod",function(d){d.preventDefault();var c=$(this).data("id");var b=$(this).data("date");showpubform(modalpubform,c,"edit",b)}).on("click","#modal_trigger_newpub",function(c){c.preventDefault();var b=$(this).data("type");showpubform(modalpubform,false,b,false,false,"modal")}).on("click",".load_content",function(h){h.preventDefault();var l=$(this).attr("href");var j=l.split("?");var b=j[1].split("&");var k={};for(var g=0;g<b.length;g++){var d=b[g].split("=");k[d[0]]=d[1]}var m=(k.op!==undefined)?k.op:false;if(m=="wishpick"){var f={show_wish_list:true};var c=$(".submission_container");var n=function(e){c.html(e).fadeIn(200)};processAjax(c,f,n,"php/form.php")}else{showpubform($(".submission_container"),false,m)}}).on("mouseover",".delete",function(){$(this).leanModal()}).on("click",".delete",function(b){b.preventDefault();delete_confirmation($(this))}).on("click",".confirm_delete",function(g){g.preventDefault();var f=$(".modal_section#delete_confirmation");var b=$('input[name="el_id"]').val();var c=$('input[name="url"]').val();var h=function(e){if(e.status===true){close_modal();$(".el_to_del#"+b).remove()}return false};var d={delete_item:true,params:c};console.log(d);processAjax(f,d,h,"php/form.php")}).on("click",".modify_ref",function(c){c.preventDefault();var b=$(this).attr("data-id");showpubform(modalpubform,b,"edit")}).on("click",".delete_ref",function(c){c.preventDefault();var b=$(this).attr("data-id");show_section("pub_delete");$("#pub_delete").append('<input type=hidden id="del_pub" value="'+b+'"/>')}).on("click",".pub_back_btn",function(b){b.preventDefault();show_section("submission_form")}).on("click","#confirm_pubdel",function(f){f.preventDefault();var d=$("input#del_pub").val();var c={del_pub:d};var b=$(".modal_section#pub_delete");var g=function(e){if(e.status===true){close_modal(".modalContainer");$("#"+d).remove()}};processAjax(b,c,g,"php/form.php")}).on("click",".modal_trigger_changepw",function(b){b.preventDefault();show_section("user_changepw")}).on("click",".back_btn",function(b){b.preventDefault();show_section("user_login");return false}).on("click",".gotoregister",function(b){b.preventDefault();show_section("user_register")}).on("click",".confirmdeleteuser",function(d){d.preventDefault();var b=$(this);var c=b.length>0?$(b[0].form):$();var f=function(e){if(e.status===true){logout()}};processForm(c,f);d.stopImmediatePropagation()}).on("click"," .login",function(d){d.preventDefault();var b=$(this);var c=b.length>0?$(b[0].form):$();var f=function(e){if(e.status===true){location.reload()}};processForm(c,f);d.stopImmediatePropagation()}).on("click",".register",function(d){d.preventDefault();var b=$(this);var c=b.length>0?$(b[0].form):$();var f=function(e){if(e.status===true){close_modal(".modalContainer")}};processForm(c,f);d.stopImmediatePropagation()})});