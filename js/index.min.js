var showpubform=function(a,f,c,b,e){if(f===undefined){f=false}if(c===undefined){c="submit"}if(b===undefined){b=false}if(e===undefined){e=false}var d={getpubform:f,type:c,date:b,prestype:e};var g=function(h){a.html(h).fadeIn(200)};processAjax(a,d,g);loadCalendar()};var showpostform=function(d){var a=$(".postcontent");var b={post_show:true,postid:d};var c=function(e){var f="<textarea name='content' id='post_content' class='tinymce'>"+e.content+"</textarea>";$(".postcontent").empty().html(e.form).fadeIn(200);$(".post_txtarea").html(f).show();tinyMCE.remove();window.tinymce.dom.Event.domLoaded=true;tinymcesetup()};processAjax(a,b,c)};var inititdatepicker=function(b,a){$("#datepicker").datepicker({defaultDate:a,firstDay:1,dateFormat:"yy-mm-dd",inline:true,showOtherMonths:true,beforeShowDay:function(d){var l=d.getDay();var n=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];var k=$.datepicker.formatDate("dd-mm-yy",d);var j=new Date();if(n[l]===b.jc_day){var f="activeday";var h=$.inArray(k,b.booked);var e=b.status[h];var g=(e!=="none");if(h>-1){var i=b.sessiontype[h];var m=b.max_nb_session-b.nb[h];var c=i+": ("+m+" presentation(s) available)";if(e==="Free"){return[g,"jcday "+f,c]}else{if(e==="Booked"){return[g,"jcday_rem "+f,c]}else{return[g,"bookedday "+f,i+": Booked out"]}}}else{return[g,"jcday "+f,b.max_nb_session+" presentation(s) available"]}}else{if(n[l]!==b.jc_day){return[false,"","Not a journal club day"]}}}})};var logout=function(){$(".warningmsg").remove();jQuery.ajax({url:"php/form.php",type:"POST",data:{logout:true},success:function(b){var a=jQuery.parseJSON(b);$(".mainbody").append("<div class='logoutWarning'>You have been logged out!</div>");$(".logoutWarning").fadeIn(200);setTimeout(function(){$(".logoutWarning").fadeOut(200).empty().hide();window.location=a},3000)}})};var modalpubform=$(".modal_section#submission_form");var displaypub=function(b,a){b=(b===undefined)?false:b;jQuery.ajax({url:"php/form.php",type:"POST",async:false,data:{show_pub:b},success:function(d){var c=jQuery.parseJSON(d);a.hide().html(c).fadeIn(200);loadCalendar()}})};function realWidth(b){var c=b.clone();c.css("visibility","hidden");$("body").append(c);var a=c.outerWidth();c.remove();return a}$(document).ready(function(){var a;$(".mainbody").on("click","#float_menu",function(){var c=$(this).position();var b=$(this).outerHeight();$(".sideMenu").css({top:b+"px",left:c.left+"px"}).animate({width:"toggle"})}).on("click",".submenu_trigger",function(i){i.preventDefault();var j=$(this).parent("li");var c=j.offset();var h=j.position();var g=j.outerWidth();var k=j.outerHeight();var f=$(this).attr("id");var b;if($(this).closest("div").hasClass("sideMenu")){b=$(".sideMenu nav.submenu#"+f);b.toggle(200)}else{b=$(".topnav nav.submenu#"+f);var l=realWidth(b);var d;if(c.left+g+l<$(window).width()){d=h.left}else{d=h.left-l}b.css({left:d+"px",top:h.top+k+"px"}).toggle(200)}}).on("click",".menu-section",function(c){c.preventDefault();c.stopPropagation();$(".menu-section").removeClass("activepage");$(this).addClass("activepage");if($(this).is("[id]")){var b=$(this).attr("id");var f=($(this).is("[data-param]"))?$(this).attr("data-param"):false;getPage(b,f);$(".submenu, .dropdown").hide()}var d=$(".sideMenu");if(d.is(":visible")){d.animate({width:"toggle"})}}).on("click",function(b){var d=$("nav");var c=$(".sideMenu");if(!$("#float_menu").is(b.target)&&$("#float_menu").has(b.target).length===0){if(!d.is(b.target)&&d.has(b.target).length===0){$(".submenu").hide()}if(c.is(":visible")&&!c.is(b.target)&&c.has(b.target).length===0){c.animate({width:"toggle"})}}}).on("mouseenter","#core, .submission",function(b){b.preventDefault()}).on("click",".change_pwd",function(f){f.preventDefault();var c=$(this).closest("form");var b=$(this).attr("id");var d={change_pw:true,email:b};processAjax(c,d)}).on("click",".conf_changepw",function(f){f.preventDefault();var b=$(this);var c=b.length>0?$(b[0].form):$();if(!checkform(c)){return false}var d=c.serialize();var g=function(e){if(e.status===true){setTimeout(logout,2000)}};processAjax(c,d,g)}).on("click",".user_select",function(c){c.preventDefault();var b=$(this).data("filter");jQuery.ajax({url:"php/form.php",type:"POST",async:true,data:{user_select:b},success:function(e){var d=jQuery.parseJSON(e);$("#user_list").html(d)}});return false}).on("change",".modify_status",function(d){d.preventDefault();var h=$("#user_list");var g=$(this).attr("data-user");var b=$(this).val();var c={modify_status:true,username:g,option:b};var f=function(e){setTimeout(function(){$("#user_list").html(e.content)},2000)};processAjax(h,c,f)}).on("click",".add_email",function(g){g.preventDefault();var b=$(this).prev(".select_emails_selector");var f=b.length>0?$(b[0].form):$();var c=b.find("option:selected").html();var i=b.val();var h=$(this).closest(".select_emails_container").find(".select_emails_list");var d=f.find("input[name='emails']");jQuery.ajax({url:"php/form.php",type:"post",data:{add_emails:i},success:function(j){var e=jQuery.parseJSON(j);if(e.status){if(d!==undefined&&d.length>0){var k=d.val().split(",");k.push(e.ids);k=(k[0]==="")?k.slice(1,k.length):k;d.val(k.join(","))}else{f.append("<input name='emails' type='hidden' value='"+e.ids+"'/>")}h.append(e.content)}}})}).on("click",".added_email_delete",function(f){var d=$(this).closest("form");var i=$(this).attr("id");var h=$(".added_email#"+i);var c=d.find("input[name='emails']");var g=c.val().split(",");var b=g.indexOf(i);if(b>-1){g.splice(b,1)}c.val(g.join(","));console.log(h);h.remove()}).on("click",".mailing_send",function(g){g.preventDefault();var d=$(this).length>0?$($(this)[0].form):$();if(!checkform(d)){return false}var f=d.serializeArray();var c=tinyMCE.get("spec_msg").getContent();var b=[];d.find("input.upl_link").each(function(){b.push($(this).val())});b=b.join(",");f=modArray(f,"spec_msg",c);f=modArray(f,"attachments",b);processAjax(d,f)}).on("click",".mail_preview",function(c){c.preventDefault();var b=$(this).attr("id");jQuery.ajax({url:"php/form.php",type:"post",async:true,data:{preview:b},success:function(e){var d=jQuery.parseJSON(e);$(".mail_preview_container").hide().html(d.body).fadeIn(200)}})}).on("change",".select_post",function(b){b.preventDefault();var c=$(this).val();showpostform(c)}).on("click",".post_new",function(b){b.preventDefault();showpostform(false)}).on("click",".post_del",function(c){c.preventDefault();var f=$(this).attr("data-id");var b={post_del:true,postid:f};var d=function(e){if(e.status===true){showpostform(false)}};processAjax(".postcontent",b,d)}).on("click",".submit_post",function(f){f.preventDefault();var c=$(this).closest("#post_form");if(!checkform(c)){return false}var g=function(e){if(e.status===true){showpostform(false)}};var d=c.serializeArray();var b=tinyMCE.get("post_content").getContent();d=modArray(d,"content",b);processAjax(c,d,g)}).on("click",".type_add",function(d){var c=$(this).attr("data-class");var b=$("input#new_"+c+"_type").val();jQuery.ajax({url:"php/form.php",type:"POST",async:true,data:{add_type:c,typename:b},success:function(f){var e=jQuery.parseJSON(f);if(e!==false){$(".type_list#"+c).html(e);$("input#new_"+c+"_type").empty()}else{showfeedback("<span id='warning'>We could not add this new category","feedback_"+c)}}})}).on("click",".type_del",function(d){var b=$(this).attr("data-type");var c=$(this).attr("data-class");jQuery.ajax({url:"php/form.php",type:"POST",async:true,data:{del_type:c,typename:b},success:function(f){var e=jQuery.parseJSON(f);if(e!==false){$(".type_list#"+c).html(e)}}})}).on("change",".session_type_default",function(d){d.preventDefault();var f=$("#session_type");var b=$(this).val();var c={session_type_default:b};processAjax(f,c)}).on("change",".selectSession",function(f){var c=$(this).val();var b=($(this).attr("data-status").length)?$(this).data("status"):"admin";var d={show_session:c,status:b};var h=$("#sessionlist");var g=function(e){$("#sessionlist").html(e).fadeIn(200)};processAjax(h,d,g)}).on("focus",".modSpeaker",function(){a=$(this).val()}).on("change",".modSpeaker",function(){var d=$(this).val();var b=$(this).closest(".pres_container");var f=b.attr("id");var c=$(this).closest(".session_div").data("id");var e={modSpeaker:d,previous:a,presid:f,date:c};processAjax($("body"),e)}).on("change",".mod_session",function(g){g.preventDefault();var h=$(this).attr("name");var d=$(this).val();var b=$(this).closest(".session_div");var f=b.data("id");var c={modSession:true,session:f,prop:h,value:d};processAjax(b,c)}).on("change",".archive_select",function(d){d.preventDefault();var b=$(this).val();var c={select_year:b};var g=function(e){$("#archives_list").html(e)};var f=$("#archives_list");processAjax(f,c,g)}).on("change","#select_wish",function(d){d.preventDefault();var c=$(this).val();var b=$(".submission");showpubform(b,c,"submit")}).on("click",".dl_btn",function(){$(".dlmenu").toggle()}).on("click",".link_name",function(){var b=$(this).attr("id");var c="uploads/"+b;window.open(c,"_blank")}).on("change","select#type",function(d){d.preventDefault();var c=$(".submission #guest");var b=$(this).val();c.prop("required",false);if(b=="guest"){c.prop("required",true).fadeIn()}else{c.prop("required",false).hide()}}).on("click",".submit_pres",function(h){h.preventDefault();var f=$(this).attr("name");var c=$(this).length>0?$($(this)[0].form):$();var i=$("select#type").val();if(!checkform(c)){return false}if(f!=="suggest"){var d=$("input#datepicker").val();if((d==="0000-00-00"||d==="")&&i!=="wishlist"){showfeedback('<p id="warning">You must choose a date!</p>');$("input#datepicker").focus();return false}}var b=$("input.upl_link");if(b[0]){var k=new Array();b.each(function(){var e=$(this).val();k.push(e)});k=k.join(",");c.append("<input type='hidden' name='link' value='"+k+"'>")}var g=c.serialize();var j=function(e){var l=$("section#submission_form, .modal_section#submission_form");if(e.status===true){showpubform(l,false)}};processAjax(c,g,j)}).on("click","#logout",function(b){b.preventDefault();logout()}).on("click","#modal_trigger_pubcontainer",function(c){c.preventDefault();var b=$(this).attr("data-id");displaypub(b,modalpubform)}).on("click","#modal_trigger_pubmod",function(d){d.preventDefault();var c=$(this).data("id");var b=$(this).data("date");showpubform(modalpubform,c,"submit",b)}).on("click","#modal_trigger_newpub",function(c){c.preventDefault();var b=$(this).data("type");showpubform(modalpubform,false,b)}).on("click",".modify_ref",function(c){c.preventDefault();var b=$(this).attr("data-id");showpubform(modalpubform,b,"submit")}).on("click",".delete_ref",function(c){c.preventDefault();var b=$(this).attr("data-id");show_section("pub_delete");$("#pub_delete").append('<input type=hidden id="del_pub" value="'+b+'"/>')}).on("click",".pub_back_btn",function(b){b.preventDefault();show_section("submission_form")}).on("click","#confirm_pubdel",function(f){f.preventDefault();var d=$("input#del_pub").val();var c={del_pub:d};var b=$(".modal_section#pub_delete");var g=function(e){if(e.status===true){close_modal(".modalContainer");$("#"+d).remove()}};processAjax(b,c,g)}).on("click",".modal_trigger_changepw",function(b){b.preventDefault();show_section("user_changepw")}).on("click",".back_btn",function(b){b.preventDefault();show_section("user_login");return false}).on("click",".gotoregister",function(b){b.preventDefault();show_section("user_register")}).on("click",".confirmdeleteuser",function(d){d.preventDefault();var b=$(this);var c=b.length>0?$(b[0].form):$();var f=function(e){if(e.status===true){logout()}};processForm(c,f)}).on("click",".login",function(d){d.preventDefault();var b=$(this);var c=b.length>0?$(b[0].form):$();var f=function(e){if(e.status===true){location.reload()}};processForm(c,f)}).on("click",".register",function(d){d.preventDefault();var b=$(this);var c=b.length>0?$(b[0].form):$();var f=function(e){if(e.status===true){close_modal(".modalContainer")}};processForm(c,f)})});