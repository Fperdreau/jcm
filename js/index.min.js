var showpubform=function(a,f,c,b,e){if(f===undefined){f=false}if(c===undefined){c="submit"}if(b===undefined){b=false}if(e===undefined){e=false}var d={getpubform:f,type:c,date:b,prestype:e};var g=function(h){a.html(h).fadeIn(200).find("textarea").html(h.content);tinyMCE.remove();window.tinymce.dom.Event.domLoaded=true;tinymcesetup()};processAjax(a,d,g,"php/form.php");loadCalendarSessions()};var showpostform=function(d){var a=$(".postcontent");var b={post_show:true,postid:d};var c=function(e){var f="<textarea name='content' id='post_content' class='tinymce'>"+e.content+"</textarea>";$(".postcontent").empty().html(e.form).fadeIn(200);$(".post_txtarea").html(f).show();tinyMCE.remove();window.tinymce.dom.Event.domLoaded=true;tinymcesetup()};processAjax(a,b,c,"php/form.php")};var selected=new Date().getTime();var inititdatepicker=function(a){$("#datepicker").datepicker({defaultDate:selected,firstDay:1,dateFormat:"yy-mm-dd",inline:true,showOtherMonths:true,beforeShowDay:function(b){return renderCalendarCallback(b,a)}})};var initAvailabilityCalendar=function(a){var b=$("#availability_calendar");b.datepicker({defaultDate:selected,onSelect:function(d,c){selected=$(this).datepicker("getDate").getTime();jQuery.ajax({url:"php/form.php",type:"post",data:{update_user_availability:true,date:d},success:function(){loadCalendarAvailability()}})},firstDay:1,dateFormat:"yy-mm-dd",inline:true,showOtherMonths:true,beforeShowDay:function(c){return renderCalendarCallback(c,a)}})};function renderCalendarCallback(b,e){var k=b.getDay();var m=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];var j=$.datepicker.formatDate("dd-mm-yy",b);if(m[k]===e.jc_day){var f="activeday";var n="";var h=$.inArray(j,e.jc_day);var d=e.status[h];var g=(d!=="none");if(h>-1){var i=jcdays.sessiontype[h];var l=jcdays.max_nb_session-jcdays.nb[h];n=i+": ("+l+" presentation(s) available)";if(d==="Free"){f="jcday "+f}else{if(d==="Booked"){f="jcday_rem "+f}else{f="bookedday "+f;n=i+": Booked out"}}f="bookedday "+f}else{f="jcday "+f;n=e.max_nb_session+" presentation(s) available"}var a=$.inArray(j,e.Availability);if(a>-1){f="not_available ";n="Not available"}var c=$.inArray(j,e.Assignments);if(c>-1){f="assigned ";n="You are presenting this day"}return[g,f,n]}else{if(m[k]!==e.jc_day){return[false,"","Not a journal club day"]}}}var logout=function(){$(".warningmsg").remove();jQuery.ajax({url:"php/form.php",type:"POST",data:{logout:true},success:function(b){var a=jQuery.parseJSON(b);$(".mainbody").append("<div class='logoutWarning'>You have been logged out!</div>");$(".logoutWarning").fadeIn(200);setTimeout(function(){$(".logoutWarning").fadeOut(200).empty().hide();window.location=a},3000)}})};var modalpubform=$(".modal_section#submission_form");var displaypub=function(b,a){b=(b===undefined)?false:b;jQuery.ajax({url:"php/form.php",type:"POST",async:false,data:{show_pub:b},success:function(d){var c=jQuery.parseJSON(d);a.hide().html(c).fadeIn(200);loadCalendarSessions()}})};function realWidth(b){var c=b.clone();c.css("visibility","hidden");$("body").append(c);var a=c.outerWidth();c.remove();return a}$(document).ready(function(){var a;$(".mainbody").on("click","#float_menu",function(){var c=$(this).position();var b=$(this).outerHeight();var d=$(window).height();$(".sideMenu").css({top:b+"px",left:c.left+"px",height:(d-b)+"px","max-height":(d-b)+"px"}).animate({width:"toggle"})}).on("mouseenter",".submitMenuSection",function(d){d.preventDefault();var c=$(this).find(".icon_container");var f=c.find(".text");var b=c.find(".icon");c.animate({left:"-="+b.outerWidth()+"px"},200,function(){});f.css({visibility:"visible"})}).on("mouseleave",".submitMenuSection",function(d){d.preventDefault();var c=$(this).find(".icon_container");var f=c.find(".text");var b=c.find(".icon");c.animate({left:"+="+b.outerWidth()+"px"},200,function(){});f.css({visibility:"hidden"})}).on("click",".submenu_trigger",function(i){i.preventDefault();var j=$(this).parent("li");var c=j.offset();var h=j.position();var g=j.outerWidth();var k=j.outerHeight();var f=$(this).attr("id");var b;if($(this).closest("div").hasClass("sideMenu")){b=$(".sideMenu nav.submenu#"+f);b.toggle(200)}else{b=$(".topnav nav.submenu#"+f);var l=realWidth(b);var d;if(c.left+g+l<$(window).width()){d=h.left}else{d=h.left-l}b.css({left:d+"px",top:h.top+k+"px"}).toggle(200)}}).on("click",".menu-section",function(c){c.preventDefault();c.stopPropagation();$(".menu-section").removeClass("activepage");$(this).addClass("activepage");if($(this).is("[id]")){var b=$(this).attr("id");var f=($(this).is("[data-param]"))?$(this).attr("data-param"):false;getPage(b,f);$(".submenu, .dropdown").hide()}var d=$(".sideMenu");if(d.is(":visible")){d.animate({width:"toggle"})}}).on("click",function(b){var d=$("nav");var c=$(".sideMenu");if(!$("#float_menu").is(b.target)&&$("#float_menu").has(b.target).length===0){if(!d.is(b.target)&&d.has(b.target).length===0){$(".submenu").hide()}if(c.is(":visible")&&!c.is(b.target)&&c.has(b.target).length===0){c.animate({width:"toggle"})}}}).on("mouseenter","#core, .submission",function(b){b.preventDefault()}).on("change","#availability_calendar",function(){alert($(this).val())}).on("click",".change_pwd",function(f){f.preventDefault();var c=$(this).closest("form");var b=$(this).attr("id");var d={change_pw:true,email:b};processAjax(c,d,null,"php/form.php")}).on("click",".conf_changepw",function(f){f.preventDefault();var b=$(this);var c=b.length>0?$(b[0].form):$();if(!checkform(c)){return false}var d=c.serialize();var g=function(e){if(e.status===true){setTimeout(logout,2000)}};processAjax(c,d,g,"php/form.php")}).on("click",".user_select",function(c){c.preventDefault();var b=$(this).data("filter");jQuery.ajax({url:"php/form.php",type:"POST",async:true,data:{user_select:b},success:function(e){var d=jQuery.parseJSON(e);$("#user_list").html(d)}});return false}).on("change",".modify_status",function(d){d.preventDefault();var h=$("#user_list");var g=$(this).attr("data-user");var b=$(this).val();var c={modify_status:true,username:g,option:b};var f=function(e){setTimeout(function(){$("#user_list").html(e.content)},2000)};processAjax(h,c,f,"php/form.php")}).on("click",".add_email",function(g){g.preventDefault();var b=$(".select_emails_selector");var f=b.length>0?$(b[0].form):$();var c=b.find("option:selected").html();var i=b.val();var h=$(".select_emails_container").find(".select_emails_list");$(".select_emails_container").find(".select_emails_list").find(".mailing_recipients_empty").remove();var d=f.find("input[name='emails']");jQuery.ajax({url:"php/form.php",type:"post",data:{add_emails:i},success:function(j){var e=jQuery.parseJSON(j);if(e.status){if(d!==undefined&&d.length>0){var k=d.val().split(",");k.push(e.ids);k=(k[0]==="")?k.slice(1,k.length):k;d.val(k.join(","))}else{f.append("<input name='emails' type='hidden' value='"+e.ids+"'/>")}h.append(e.content)}}})}).on("click",".added_email_delete",function(f){var d=$(this).closest("form");var i=$(this).attr("id");var h=$(".added_email#"+i);var c=d.find("input[name='emails']");var g=c.val().split(",");var b=g.indexOf(i);if(b>-1){g.splice(b,1)}c.val(g.join(","));h.remove()}).on("click",".mailing_send",function(h){h.preventDefault();var f=$(this).length>0?$($(this)[0].form):$();var c=$(".mailing_container");var i=$(".select_emails_container").find(".select_emails_list");i.find(".mailing_recipients_empty").remove();if(!$.trim(i.html()).length){i.html('<p class="mailing_recipients_empty sys_msg warning leanmodal" id="warning">You must select recipients before sending your email by clicking on the "+" button!</p>');return true}if(!checkform(f)){return false}var g=f.serializeArray();var d=tinyMCE.get("spec_msg").getContent();var b=[];f.find("input.upl_link").each(function(){b.push($(this).val())});b=b.join(",");g=modArray(g,"spec_msg",d);g=modArray(g,"attachments",b);processAjax(c,g,null,"php/form.php")}).on("click",".mail_preview",function(c){c.preventDefault();var b=$(this).attr("id");jQuery.ajax({url:"php/form.php",type:"post",async:true,data:{preview:b},success:function(e){var d=jQuery.parseJSON(e);$(".mail_preview_container").hide().html(d.body).fadeIn(200)}})}).on("change",".select_post",function(b){b.preventDefault();var c=$(this).val();showpostform(c)}).on("click",".post_new",function(b){b.preventDefault();showpostform(false)}).on("click",".post_del",function(c){c.preventDefault();var f=$(this).attr("data-id");var b={post_del:true,postid:f};var d=function(e){if(e.status===true){showpostform(false)}};processAjax(".postcontent",b,d,"php/form.php")}).on("click",".submit_post",function(f){f.preventDefault();var c=$(this).closest("#post_form");if(!checkform(c)){return false}var g=function(e){if(e.status===true){showpostform(false)}};var d=c.serializeArray();var b=tinyMCE.get("post_content").getContent();d=modArray(d,"content",b);processAjax(c,d,g,"php/form.php")}).on("click",".type_add",function(d){var c=$(this).attr("data-class");var b=$("input#new_"+c+"_type").val();jQuery.ajax({url:"php/form.php",type:"POST",async:true,data:{add_type:c,typename:b},success:function(f){var e=jQuery.parseJSON(f);if(e!==false){$(".type_list#"+c).html(e);$("input#new_"+c+"_type").empty()}else{showfeedback("<span class='sys_msg warning'>We could not add this new category","feedback_"+c)}}})}).on("click",".type_del",function(d){var b=$(this).attr("data-type");var c=$(this).attr("data-class");jQuery.ajax({url:"php/form.php",type:"POST",async:true,data:{del_type:c,typename:b},success:function(f){var e=jQuery.parseJSON(f);if(e!==false){$(".type_list#"+c).html(e)}}})}).on("change",".session_type_default",function(d){d.preventDefault();var f=$("#session_type");var b=$(this).val();var c={session_type_default:b};processAjax(f,c,null,"php/form.php")}).on("change",".selectSession",function(f){f.preventDefault();var c=$(this).val();var b=($(this).attr("data-status").length)?$(this).data("status"):"admin";var d={show_session:c,status:b};var h=$("#sessionlist");var g=function(e){$("#sessionlist").html(e).fadeIn(200)};processAjax(h,d,g,"php/form.php")}).on("focus",".modSpeaker",function(){a=$(this).val()}).on("change",".modSpeaker",function(){var d=$(this).val();var b=$(this).closest(".pres_container");var f=b.attr("id");var c=$(this).closest(".session_div").data("id");var e={modSpeaker:d,previous:a,presid:f,date:c};processAjax($("body"),e,null,"php/form.php")}).on("change",".mod_session",function(g){g.preventDefault();var h=$(this).attr("name");var d=$(this).val();var b=$(this).closest(".session_div");var f=b.data("id");var c={modSession:true,session:f,prop:h,value:d};processAjax(b,c,null,"php/form.php")}).on("change",".mod_session_type",function(g){g.preventDefault();var h=$(this).attr("name");var d=$(this).val();var b=$(this).closest(".session_div");var f=b.data("id");var c={mod_session_type:true,session:f,prop:h,value:d};processAjax(b,c,null,"php/form.php")}).on("change",".archive_select",function(d){d.preventDefault();var b=$(this).val();var c={select_year:b};var g=function(e){$("#archives_list").html(e)};var f=$("#archives_list");processAjax(f,c,g,"php/form.php")}).on("change","#select_wish",function(d){d.preventDefault();var c=$(this).val();var b=$(".submission");showpubform(b,c,"submit")}).on("click",".dl_btn",function(){$(".dlmenu").toggle()}).on("click",".link_name",function(){var b=$(this).attr("id");var c="uploads/"+b;window.open(c,"_blank")}).on("change","select#type",function(h){h.preventDefault();var g=$(this).length>0?$($(this)[0].form):$();var f=g.find("#guest");var b=g.find("input[name='title']").parent(".formcontrol");var c=g.find("input[name='authors']").parent(".formcontrol");var d=$(this).val();f.prop("required",false);if(d==="guest"){f.prop("required",true).fadeIn()}else{f.prop("required",false).hide()}if(d=="minute"){b.prop("required",true).hide();c.prop("required",true).hide()}else{b.prop("required",false).fadeIn();c.prop("required",false).fadeIn()}}).on("click",".submit_pres",function(i){i.preventDefault();var f=$(this).attr("name");var c=$(this).length>0?$($(this)[0].form):$();var j=$("select#type").val();if(!checkform(c)){return false}if(f!=="suggest"){var d=$("input#datepicker").val();if((d==="0000-00-00"||d==="")&&j!=="wishlist"){showfeedback('<p id="warning">You must choose a date!</p>');c.find("input#datepicker").focus();return false}}var b=$("input.upl_link");if(b[0]){var l=[];b.each(function(){var e=$(this).val();l.push(e)});l=l.join(",");c.append("<input type='hidden' name='link' value='"+l+"'>")}var g=c.serializeArray();var k=function(e){$("section#submission_form, .modal_section#submission_form").empty();if(e.status===true){close_modal()}};var h=c.find(".tinymce");if(h.length>0&&h!==undefined){h.each(function(){var n=$(this).attr("id");var m=$(this).attr("name");var e=tinyMCE.get(n).getContent();g=modArray(g,m,e)})}processAjax(c,g,k,"php/form.php")}).on("click","#logout",function(b){b.preventDefault();logout()}).on("click","#modal_trigger_pubcontainer",function(c){c.preventDefault();var b=$(this).attr("data-id");displaypub(b,modalpubform)}).on("click","#modal_trigger_pubmod",function(d){d.preventDefault();var c=$(this).data("id");var b=$(this).data("date");showpubform(modalpubform,c,"submit",b)}).on("click","#modal_trigger_newpub",function(c){c.preventDefault();var b=$(this).data("type");showpubform(modalpubform,false,b)}).on("click",".modify_ref",function(c){c.preventDefault();var b=$(this).attr("data-id");showpubform(modalpubform,b,"submit")}).on("click",".delete_ref",function(c){c.preventDefault();var b=$(this).attr("data-id");show_section("pub_delete");$("#pub_delete").append('<input type=hidden id="del_pub" value="'+b+'"/>')}).on("click",".pub_back_btn",function(b){b.preventDefault();show_section("submission_form")}).on("click","#confirm_pubdel",function(f){f.preventDefault();var d=$("input#del_pub").val();var c={del_pub:d};var b=$(".modal_section#pub_delete");var g=function(e){if(e.status===true){close_modal(".modalContainer");$("#"+d).remove()}};processAjax(b,c,g,"php/form.php")}).on("click",".modal_trigger_changepw",function(b){b.preventDefault();show_section("user_changepw")}).on("click",".back_btn",function(b){b.preventDefault();show_section("user_login");return false}).on("click",".gotoregister",function(b){b.preventDefault();show_section("user_register")}).on("click",".confirmdeleteuser",function(d){d.preventDefault();var b=$(this);var c=b.length>0?$(b[0].form):$();var f=function(e){if(e.status===true){logout()}};processForm(c,f)}).on("click",".login",function(d){d.preventDefault();var b=$(this);var c=b.length>0?$(b[0].form):$();var f=function(e){if(e.status===true){location.reload()}};processForm(c,f)}).on("click",".register",function(d){d.preventDefault();var b=$(this);var c=b.length>0?$(b[0].form):$();var f=function(e){if(e.status===true){close_modal(".modalContainer")}};processForm(c,f)})});