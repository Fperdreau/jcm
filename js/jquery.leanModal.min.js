(function(a){a.widget("nmk.modalTrigger",{options:{top:100,overlay:0.5,closeButton:".modal_close",load:true,callback:null,modal_id:"#modal",container:".modalContainer"},_window:null,_create:function(){if(this.element.data("leanModal")!==undefined){return this}else{this.element.data("leanModal",true)}var b=this.element.data("modal");this._setOption("modal_id",(b===undefined)?"#modal":b);this._on(this.element,{click:"onClick"});return this},setWindow:function(){this._window=a(this.options.container+this.options.modal_id);if(this._window.data("nmkModalWindow")===undefined){this._window.modalWindow();this._window.modalWindow("option",this.options);this._window.modalWindow("setData",this.element.data())}},getWindow:function(){return this._window},_addOverlay:function(){var b=a("<div id='lean_overlay'></div>");if(a("#lean_overlay").length===0){a("body").append(b)}},showOverlay:function(){var b=a("#lean_overlay");if(b.length>0&&!b.is(":visible")){b.css({display:"block",opacity:0}).fadeTo(200,this.options.overlay)}},onClick:function(b){b.preventDefault();this._addOverlay();this.showOverlay();this._loadContent()},close:function(){if(this._window!==null){this._window.modalWindow("close")}},_loadContent:function(){if(this.options.load===true){this._window.modalWindow("loadContent",this.element.data())}},_setOptions:function(){this._superApply(arguments)},_setOption:function(b,c){this._super(b,c)}});a.widget("nmk.modalWindow",{options:{top:100,closeButton:".modal_close",callback:null,headerHeight:35,footerHeight:55},_data:{},_create:function(){this._bind_close()},setData:function(b){this._data=a.extend(this._data,b)},_bind_close:function(){var b=a("<div id='lean_overlay'></div>");var c=this.options.modal_id;var d=this;b.click(function(){d.close(c)});a(this.options.closeButton).click(function(){d.close(c)})},loadContent:function(b){delete b.nmkModalTrigger;this._load_section(b,this.options.callback)},close:function(){a("#lean_overlay").fadeOut(200);a(this.element).css({display:"none"})},_load_section:function(d,f){var c=this.element.find(".popupBody");var b=c.find(".modal_section#"+d.section);if(b.length>0){b.remove()}var e=this;d.get_modal=true;jQuery.ajax({url:"php/form.php",data:d,type:"post",async:true,beforeSend:function(){e._animate_before()},complete:function(){e._removeLoading()},success:function(h){var g=jQuery.parseJSON(h);c.append(g);e.show_section(d.section,e.options.modal_id);if(e.options.callback!==null){e.options.callback()}},error:function(){e._removeLoading()}})},_animate_before:function(){if(!this.element.is(":visible")){var b=150;var c=150;var e=(a(window).height()-c)*0.5;var d=(a(window).width()*0.5)-b;this.element.css({height:c+"px",width:b+"px",overflow:"hidden","margin-left":0,top:e+"px",left:d+"px"})}this._addLoading()},_addLoading:function(){this.element.css("position","relative").append("<div class='loadingDiv' style='width: 100%; height: 100%;'></div>").show();this.element.find(".loadingDiv").css("z-index",12000)},_removeLoading:function(){this.element.fadeIn(200).find(".loadingDiv").fadeOut(1000).remove()},show_section:function(d){var b=this.element.find(".popupBody");var e=this.element.find(".modal_section");var c=this._tagSections(e);e.hide();this._toggleBackBtn(c);if(b.children(".modal_section#"+d).length>0){this._transition(d);this._setCurrentSection(d)}},_toggleBackBtn:function(b){if(this.element.find(".back_btn").length>0){this.element.find(".back_btn").remove()}if(b!==null&&b.length>0){var c="<div class='back_btn' data-prev='"+b+"'></div>";this.element.find(".float_buttons_container").prepend(c)}},_tagSections:function(c){var b=null;c.each(function(){if(a(this).is(":visible")||a(this).hasClass("current_section")){a(this).addClass("previous_section");a(this).removeClass("current_section");b=a(this).attr("id")}else{if(a(this).hasClass("previous_section")){a(this).removeClass("previous_section")}}});return b},_setCurrentSection:function(b){this.element.find(".modal_section#"+b).addClass("current_section")},_resize:function(e){var b=this._getDimensions(e);var c=Math.round(0.9*b.window.height)-b.header.height;var d=Math.min(b.section.height,c)+(this.options.headerHeight+this.options.footerHeight);var f=d-(this.options.headerHeight+this.options.footerHeight);this.element.find(".popupContent").css({"max-height":f+"px"});b.new_max_height=d;b.body_max_height=f;return b},_getDimensions:function(b){return{section:this._realDim(b),content:this._realDim(b.find(".popupContent")),header:this._realDim(b.find(".popupHeader")),footer:this._realDim(b.find(".modal_buttons_container")),modal:this._realDim(this.element),window:{width:a(window).width(),height:a(window).height()}}},_transition:function(b){var d=this.element.find(".modal_section#"+b);this.element.append("<div class='blankDiv'></div>");var c=this._resize(d);this.element.css({display:"block",position:"absolute","z-index":11000,left:Math.round((0.5*c.window.width)-(0.5*c.modal.width))+"px",top:Math.round((0.5*c.window.height)-(0.5*c.modal.height))+"px"}).fadeTo(200,1).animate({top:Math.round(0.5*(c.window.height-c.new_max_height))+a(document).scrollTop()+"px",left:Math.round(0.5*(c.window.width-parseInt(c.modal["max-width"])))+"px",width:c.modal["max-width"],height:c.new_max_height+"px","margin-left":0},300,function(){a(this).find(".popupContent").css("overflow-y","auto");d.show();a(this).find(".blankDiv").css({opacity:0,transition:".15s ease-in"}).remove()})},_realDim:function(c){var d=c.clone();d.css({position:"absolute",visibility:"hidden",display:"block"});a("body").append(d);var b={height:d.outerHeight(),width:d.outerWidth(),"max-width":d.css("max-width"),"max-height":d.css("max-height")};d.remove();return b},go_to_previous:function(b){var c;if(b===undefined){c=this.element.find(".previous_section")}else{c=this.element.find(".modal_section#"+b)}if(c.length===0){return false}this.show_section(c.attr("id"))},go_to_section:function(d){var c=this.element.find(".popupBody");var b=c.find(".modal_section#"+d.section);if(b.length>0){this.show_section(d.section)}else{this._load_section(d)}},_setOptions:function(){this._superApply(arguments)},_setOption:function(b,c){this._super(b,c)}})})(jQuery);function trigger_modal(a,b,c){if(b===undefined){b=true}a.modalTrigger();a.modalTrigger("option",{top:50,overlay:0.6,closeButton:".modal_close",load:b,callback:c});a.modalTrigger("setWindow")}function in_modal(a,b){b=(b===undefined)?"modal":b;return $(".modalContainer#"+b).find(a).length>0};