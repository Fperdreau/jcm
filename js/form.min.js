var processForm=function(b,e,a,c){if(!checkform(b)){return false}var d=getData(b);a=b.attr("action");processAjax(b,d,e,a,c)};function getData(b){var c=b.serializeArray();var a=b.find(".tinymce");if(a.length>0&&a!==undefined){a.each(function(){var f=$(this).attr("id");var e=$(this).attr("name");var d=tinyMCE.get(f).getContent();c=modArray(c,e,d)})}b.find("textarea.wygiwym").each(function(){var d=CKEDITOR.instances[$(this).attr("id")].getData();var e=$(this).attr("name");c=modArray(c,e,d)});return c}function loadingButton(a){a.addClass("processform_working")}function resetButton(a){setTimeout(function(){a.removeClass("processform_success processform_working processform_failure")},1000)}function removeLoadingButton(a){a.removeClass("processform_working processform_success processform_failure")}var processAjax=function(c,e,f,a,d){var b=c.find('input[type="submit"], .processform');jQuery.ajax({url:a,type:"POST",async:true,data:e,beforeSend:function(){if(b.length>0){loadingButton(b)}else{loadingDiv(c)}},complete:function(){if(b.length>0){removeLoadingButton(b)}else{removeLoading(c)}},success:function(g){f=(f===undefined)?false:f;validsubmitform(c,g,f,d,b)},error:function(){if(b.length>0){removeLoadingButton(b)}else{removeLoading(c)}}})};var validsubmitform=function(c,e,f,d,b){c=(c===undefined)?$("body"):c;var a=jQuery.parseJSON(e);f=(f===undefined)?false:f;d=(d===undefined)?2000:d;if(b!==undefined&&b.length>0){removeLoadingButton(b);if((typeof(a)==="boolean"&&a===true)||a.status===true){b.addClass("processform_success")}else{b.addClass("processform_failure")}}if(a.msg!==undefined){showFeedBack(c,a.status,a.msg);if(a.status===true){setTimeout(function(){removeFeedBack(c);if(b!==undefined&&b.length>0){resetButton(b)}if(f!==false){f(a)}},d)}}else{if(b!==undefined&&b.length>0){resetButton(b)}removeLoading(c);if(f!==false){f(a)}}};function format_msg(a,c){var b=false;if(a===true){b=(c===undefined)?"<p class='sys_msg success'>DONE!</p>":"<p class='sys_msg success'>"+c+"</p>"}else{if(a!==undefined){b=(c===undefined)?"<p class='sys_msg warning'>Oops, something has gone wrong!</p>":"<p class='sys_msg warning'>"+c+"</p>"}}return b}function removeFeedBack(a){fade_inputs(a,false);a.find(".feedbackForm").fadeIn(500).delay(200,function(){$(this).remove()})}function fade_inputs(a,b){if(b===true){a.children("input, select, .form-group").each(function(){$(this).animate({opacity:0.2})})}else{a.children("input, select, .form-group").each(function(){$(this).animate({opacity:1},200)})}}function showFeedBack(e,b,h){var d=e.width();var a=e.height();var g=format_msg(b,h);if(!e.hasClass("feedbackFormTarget")){e.addClass("feedbackFormTarget")}if(e.attr("id")===undefined){e.attr("id","fb_"+Math.round(new Date().getTime()+(Math.random()*100)))}e.append("<div class='feedbackForm' id='"+e.attr("id")+"'></div>");var c=$(".feedbackForm");fade_inputs(e,true);c.css({left:0,width:d+"px",height:a+"px"}).html(g);var f=c.find(".sys_msg");f.empty().css({left:0,display:"none",width:0.8*d+"px"}).html(h).fadeIn(300)}var is_editor_active=function(b,c){var a;if(typeof tinyMCE==="undefined"){return false}if(typeof c==="undefined"){a=tinyMCE.activeEditor}else{a=tinyMCE.EditorManager.get(c)}if(a===null||b===undefined||!b.hasClass("tinymce")||tinyMCE.get(b.attr("id"))===null){return false}return !a.isHidden()};var checkform=function(b,c){c=(c===undefined)?b.find("input[type=submit]:focus"):c;var a=true;b.closest(".inputFeedback").remove();var d="* Required";b.find("input,select,textarea").not('input[type="submit"]').each(function(){$(this).removeClass("wrongField");var j=true;if($(this).is(":visible")&&$(this).prop("required")&&$.trim($(this).val()).length===0){j=false}if($(this).prop("required")&&is_editor_active($(this))&&tinyMCE.get($(this).attr("id")).getContent().length===0){tinymce.execCommand("mceFocus",false,"consent");j=false}if($(this).attr("maxlength")&&$(this).val().length>$(this).attr("maxlength")){j=false;d="Exceeds Maximum length ("+$(this).attr("maxlength")+")"}if($(this).attr("minlength")&&$(this).val().length>$(this).attr("minlength")){j=false;d="Too short! (minimum: "+$(this).attr("minlength")+")"}if($(this).val()!==null&&$(this).val().length>0&&$(this).attr("type")==="email"&&!checkemail($(this).val())){d="Invalid email";j=false}if(!j){$(this).addClass("wrongField");$(this).parent("div").append("<div class='inputFeedback' style='display: none;'></div>");$(this).parent("div").find(".inputFeedback").animate({width:"toggle"})}a=(!j)?j:a});var f=b.find('input[type="checkbox"]');var h={};var g=true;f.each(function(){var j=this.name;if(h[j]===undefined){g=b.find("input[name='"+j+"']:checked").length>0;if(!g){b.find("input[name='"+j+"']").last().addClass("wrongField").after("<div class='inputFeedback' style='display: none;'>*</div>").next(".inputFeedback").animate({width:"toggle"})}h[j]=j}});a=a&&g;var e=b.find("input[name=conf_password]");if(e.length>0){var i=b.find("input[name=password]").val();if(i!==e.val()){e.addClass("wrongField");d="Passwords must match";a=false}}if(!a){b.find(".feedbackSubmit").remove();c.before("<div class='feedbackSubmit' style='display: none;'>"+d+"</div>");b.find(".feedbackSubmit").animate({width:"toggle"},350)}b.find("input.wrongField:first").focus();return a};var checkemail=function(a){var b=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);return b.test(a)};var showfeedback=function(c,a,d){var b=(typeof a==="undefined")?".feedback":a;d=d===undefined?true:d;$(b).html(c).fadeIn(1000).delay(3000);if(d){$(b).fadeOut(1000)}return false};function modArray(d,e,c){var b;for(b=0;b<d.length;++b){if(d[b].name===e){d[b].value=c;return d}}var a={};a[e]=c;d.push(a);return d}$(document).ready(function(){$("body").on("click",".processform",function(d){d.preventDefault();var a=$(this);var c=a.length>0?$(a[0].form):$();var b=c.attr("action");if(a.hasClass("reload")){var f=function(e){if(e.status===true){location.reload()}}}else{f=false}processForm(c,f,b)}).on("blur","input, select, textarea",function(b){if($(this).is(":valid")&&$(this).val()!==null&&$(this).val().length>0){var a=$(this).siblings(".inputFeedback");if(a!==undefined){a.fadeOut(200)}$(this).removeClass("wrongField")}}).on("click",".feedbackForm",function(){removeFeedBack($(".feedbackFormTarget#"+$(this).attr("id")))})});