var getdrop=function(g){var d=g.dataTransfer||(g.originalEvent&&g.originalEvent.dataTransfer);var c=g.target.files||(d&&d.files);if(c){var a=c.length;for(var b=0;b<a;++b){var f=new FormData();f.append("file[]",c[b]);processUpl(f)}}};var processUpl=function(d){var b=$(".upl_container");var f=b.attr("id");var a=b.data("controller");var e=new AnimateBack(b);var c=$("form#"+f);jQuery.ajax({type:"POST",url:"php/upload.php?controller="+a,headers:{"Cache-Control":"no-cache"},data:d,contentType:false,processData:false,beforeSend:e.start(),complete:e.stop(),success:function(h){var g=jQuery.parseJSON(h);b.find(".upl_errors").hide();var i=g.error;if(i===true){if(c.length>0){c.append(g.input)}else{console.warn("No form linked to the uploader")}$(".upl_filelist").append(g.file_div)}else{b.find(".upl_errors").addClass("warning").html(i).show()}},error:function(g){b.find(".upl_errors").addClass("warning").html(g.statusText).show()}})};var sendAjax=function(d,c,e,a){a=(a===undefined)?"php/form.php":a;var b=new AnimateBack(d);jQuery.ajax({url:a,type:"POST",async:true,data:c,beforeSend:b.start(),complete:b.stop(),success:function(g){var f=jQuery.parseJSON(g);e(f)}})};function AnimateBack(a){this.el=a;this.interval=0;this.gradient_percent=0;this.interval_value=5;this.time_interval=50;this.timer=null;this.anim=function(){if(this.interval==20){this.interval=0;this.gradient_percent=0}this.gradient_percent+=this.interval_value;this.el.css("background","linear-gradient(to right, rgba(64,64,64,1) "+this.gradient_percent+"%,rgba(0,0,0,0) 100%)");this.interval++};this.start=function(){if(this.timer===null){this.timer=setInterval((function(b){return function(){b.anim()}})(this),this.time_interval)}};this.stop=function(){var b=this;if(b.timer!==null){setTimeout(function(){clearInterval(b.timer);b.el.css("background-color","rgba(68,68,68,1)");b.timer=null},1000)}}}$(document).ready(function(){var a=0;$(".mainbody").on("dragenter",".upl_container",function(b){b.stopPropagation();b.preventDefault();a++;$(".upl_container").addClass("dragging")}).on("dragleave",".upl_container",function(b){b.stopPropagation();b.preventDefault();a--;if(a===0){$(".upl_container").removeClass("dragging")}}).on("dragover",".upl_container",function(b){b.stopPropagation();b.preventDefault()}).on("drop",".upl_container",function(b){b.stopPropagation();b.preventDefault();getdrop(b);$(".upl_container").removeClass("dragging")}).on("click",".upl_btn",function(){$(".upl_input").click()}).on("change",".upl_input",function(f){f.preventDefault();var c=$(".upl_input")[0];for(var b=0;b<c.files.length;++b){var d=new FormData();d.append("file[]",c.files[b]);processUpl(d)}}).on("click",".upl_errors",function(){$(this).fadeOut().empty()}).on("click",".del_upl",function(){var c={del_upl:true,file_id:$(this).attr("id")};var b=$(".upl_container");var d=function(e){if(e.status===true){$(".upl_info#upl_"+e.uplname).remove();$(".upl_link#"+e.uplname).remove()}else{b.find(".upl_errors").html(e.msg).addClass("warning").show()}};sendAjax(b,c,d)})});