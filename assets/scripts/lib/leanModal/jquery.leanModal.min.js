function trigger_modal(t,i,e){void 0===i&&(i=!0),t.modalTrigger(),t.modalTrigger("option",{top:50,overlay:.6,closeButton:".modal_close",load:i,callback:e}),t.modalTrigger("setWindow")}function in_modal(t,i){return i=void 0===i?"modal":i,$(".modalContainer#"+i).find(t).length>0}(function(t){t.widget("nmk.modalTrigger",{options:{top:100,overlay:.5,closeButton:".modal_close",load:!0,callback:null,modal_id:"#modal",container:".modalContainer"},_window:null,_create:function(){if(void 0!==this.element.data("leanModal"))return this;this.element.data("leanModal",!0);var t=this.element.data("modal");return this._setOption("modal_id",void 0===t?"#modal":t),this._on(this.element,{click:"onClick"}),this},setWindow:function(){this._window=t(this.options.container+this.options.modal_id),void 0===this._window.data("nmkModalWindow")&&(this._window.modalWindow(),this._window.modalWindow("option",this.options),this._window.modalWindow("setData",this.element.data()))},getWindow:function(){return this._window},_addOverlay:function(){var i=t("<div id='lean_overlay'></div>");0===t("#lean_overlay").length&&t("body").append(i)},showOverlay:function(){var i=t("#lean_overlay");i.length>0&&!i.is(":visible")&&i.css({display:"block",opacity:0}).fadeTo(200,this.options.overlay)},onClick:function(t){t.preventDefault(),this._addOverlay(),this.showOverlay(),this._loadContent()},close:function(){null!==this._window&&this._window.modalWindow("close")},_loadContent:function(){this.options.load===!0&&this._window.modalWindow("loadContent",this.element.data())},_setOptions:function(){this._superApply(arguments)},_setOption:function(t,i){this._super(t,i)}}),t.widget("nmk.modalWindow",{options:{top:100,closeButton:".modal_close",callback:null,headerHeight:35,footerHeight:55},_data:{},_create:function(){this._bind_close()},setData:function(i){this._data=t.extend(this._data,i)},_bind_close:function(){var i="<div id='lean_overlay'></div>";t("body").append(i);var e=t("#lean_overlay"),n=this.options.modal_id,o=this;e.click(function(){o.close(n)}),t(this.options.closeButton).click(function(){o.close(n)})},loadContent:function(t){delete t.nmkModalTrigger,this._load_section(t,this.options.callback)},close:function(){t("#lean_overlay").fadeOut(200),t(this.element).css({display:"none"})},_load_section:function(t,i){var e=this.element.find(".popupBody"),n=e.find(".modal_section#"+t.section);n.length>0&&n.remove(),this._loadData(t,this,e,this._renderModalContent)},_renderModalContent:function(t,i,e,n){jQuery.ajax({url:"php/router.php?controller=Modal&action=render",data:i,type:"post",async:!0,beforeSend:function(){e._animate_before()},complete:function(){e._removeLoading()},success:function(i){var o=jQuery.parseJSON(i);n.append(o),e.show_section(t.section,e.options.modal_id),null!==e.options.callback&&e.options.callback()},error:function(){e._removeLoading()}})},_loadData:function(t,i,e,n){jQuery.ajax({url:t.url,data:t,type:"post",async:!0,beforeSend:function(){i._animate_before()},complete:function(){i._removeLoading()},success:function(o){var s=jQuery.parseJSON(o);n(t,s,i,e)},error:function(){i._removeLoading()}})},_animate_before:function(){if(!this.element.is(":visible")){var i=150,e=150,n=.5*(t(window).height()-e),o=.5*t(window).width()-i;this.element.css({height:e+"px",width:i+"px",overflow:"hidden","margin-left":0,top:n+"px",left:o+"px"})}this._addLoading()},_addLoading:function(){this.element.css("position","relative").append("<div class='loadingDiv' style='width: 100%; height: 100%;'></div>").show(),this.element.find(".loadingDiv").css("z-index",12e3)},_removeLoading:function(){this.element.fadeIn(200).find(".loadingDiv").fadeOut(1e3).remove()},show_section:function(t){var i=this.element.find(".popupBody"),e=this.element.find(".modal_section"),n=this._tagSections(e);e.hide(),this._toggleBackBtn(n),i.children(".modal_section#"+t).length>0&&(this._transition(t),this._setCurrentSection(t))},_toggleBackBtn:function(t){if(this.element.find(".back_btn").length>0&&this.element.find(".back_btn").remove(),null!==t&&t.length>0){var i="<div class='back_btn' data-prev='"+t+"'></div>";this.element.find(".float_buttons_container").prepend(i)}},_tagSections:function(i){var e=null;return i.each(function(){t(this).is(":visible")||t(this).hasClass("current_section")?(t(this).addClass("previous_section"),t(this).removeClass("current_section"),e=t(this).attr("id")):t(this).hasClass("previous_section")&&t(this).removeClass("previous_section")}),e},_setCurrentSection:function(t){this.element.find(".modal_section#"+t).addClass("current_section")},_resize:function(t){var i=this._getDimensions(t),e=Math.round(.9*i.window.height)-i.header.height,n=Math.min(i.section.height,e)+(this.options.headerHeight+this.options.footerHeight),o=n-(this.options.headerHeight+this.options.footerHeight);return this.element.find(".popupContent").css({"max-height":o+"px"}),i.new_max_height=n,i.body_max_height=o,i},_getDimensions:function(i){return{section:this._realDim(i),content:this._realDim(i.find(".popupContent")),header:this._realDim(i.find(".popupHeader")),footer:this._realDim(i.find(".modal_buttons_container")),modal:this._realDim(this.element),window:{width:t(window).width(),height:t(window).height()}}},_transition:function(i){var e=this.element.find(".modal_section#"+i);this.element.append("<div class='blankDiv'></div>");var n=this._resize(e);this.element.css({display:"block",position:"absolute","z-index":11e3,left:Math.round(.5*n.window.width-.5*n.modal.width)+"px",top:Math.round(.5*n.window.height-.5*n.modal.height)+"px"}).fadeTo(200,1).animate({top:Math.round(.5*(n.window.height-n.new_max_height))+t(document).scrollTop()+"px",left:Math.round(.5*(n.window.width-parseInt(n.modal["max-width"])))+"px",width:n.modal["max-width"],height:n.new_max_height+"px","margin-left":0},300,function(){t(this).find(".popupContent").css("overflow-y","auto"),e.show(),t(this).find(".blankDiv").css({opacity:0,transition:".15s ease-in"}).remove()})},_realDim:function(i){var e=i.clone();e.css({position:"absolute",visibility:"hidden",display:"block"}),t("body").append(e);var n={height:e.outerHeight(),width:e.outerWidth(),"max-width":e.css("max-width"),"max-height":e.css("max-height")};return e.remove(),n},go_to_previous:function(t){var i;return i=void 0===t?this.element.find(".previous_section"):this.element.find(".modal_section#"+t),0!==i.length&&void this.show_section(i.attr("id"))},go_to_section:function(t){var i=this.element.find(".popupBody"),e=i.find(".modal_section#"+t.section);e.length>0?this.show_section(t.section):this._load_section(t)},_setOptions:function(){this._superApply(arguments)},_setOption:function(t,i){this._super(t,i)}})})(jQuery);