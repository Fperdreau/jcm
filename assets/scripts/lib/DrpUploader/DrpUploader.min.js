function AnimateBack(t){this.el=t,this.interval=0,this.gradient_percent=0,this.interval_value=5,this.time_interval=50,this.timer=null,this.anim=function(){20===this.interval&&(this.interval=0,this.gradient_percent=0),this.gradient_percent+=this.interval_value,this.el.css("background","linear-gradient(to right, rgba(64,64,64,1) "+this.gradient_percent+"%,rgba(0,0,0,0) 100%)"),this.interval++},this.start=function(){null===this.timer&&(this.timer=setInterval(function(t){return function(){t.anim()}}(this),this.time_interval))},this.stop=function(){var t=this;null!==t.timer&&setTimeout(function(){clearInterval(t.timer),t.el.css("background-color","rgba(68,68,68,1)"),t.timer=null},1e3)}}(function(t){t.widget("nmk.DrpUploader",{_drag_counter:0,_id:null,_controller:null,_upl_btn:null,_upl_errors:null,_upl_input:null,_animator:null,_upl_list:null,_create:function(){return void 0!==this.element.data("nmk.DrpUploader")?this:(this._setElements(),void this._addEventHandlers())},_setElements:function(){this._upl_btn=this.element.find(".upl_btn"),this._upl_input=this.element.find(".upl_input"),this._upl_errors=this.element.find(".upl_errors"),this._animator=new AnimateBack(this.element),this._id=this.element.attr("id"),this._controller=this.element.data("controller"),this._upl_list=this.element.find(".upl_filelist")},_addEventHandlers:function(){this._on(this.element,{dragenter:"_dragEnter",dragleave:"_dragLeave",dragover:"_dragOver",drop:"_getDrop",click:"_dispatch"}),this._on(this._upl_btn,{click:"_onClick"}),this._on(this.document.find(".del_upl"),{click:"_delUpload"}),this._on(this._upl_input,{change:"_fireUpl"}),this._on(this._upl_errors,{click:"_removeError"})},_dispatch:function(e){t(e.target).hasClass("del_upl")&&this._delUpload(t(e.target))},_fireUpl:function(t){t.preventDefault();for(var e=this._upl_input[0],n=0;n<e.files.length;++n){var r=new FormData;r.append("file[]",e.files[n]),this._process(r)}},_dragEnter:function(t){t.stopPropagation(),t.preventDefault(),this._drag_counter++,this.element.addClass("dragging")},_dragLeave:function(t){t.stopPropagation(),t.preventDefault(),this._drag_counter--,0===this._drag_counter&&this.element.removeClass("dragging")},_dragOver:function(t){t.stopPropagation(),t.preventDefault()},_getDrop:function(t){t.stopPropagation(),t.preventDefault();var e=t.dataTransfer||t.originalEvent&&t.originalEvent.dataTransfer,n=t.target.files||e&&e.files;if(n)for(var r=0;r<n.length;++r){var i=new FormData;i.append("file[]",n[r]),this._process(i)}this.element.removeClass("dragging")},_onClick:function(){this._upl_input.click()},_process:function(e){var n=this;n._upl_errors.hide(),jQuery.ajax({type:"POST",url:"php/upload.php?controller="+n._controller,headers:{"Cache-Control":"no-cache"},data:e,contentType:!1,processData:!1,beforeSend:n._animator.start(),complete:n._animator.stop(),async:!0,success:function(e){var r=jQuery.parseJSON(e),i=r.error,a=t("form#"+n._id);i===!0?(a.length>0?a.append(r.input):console.warn("No form linked to the uploader"),n._upl_list.append(r.file_div)):n._upl_errors.addClass("warning").html(i).show()},error:function(t){n._animator.stop(),n._upl_errors.addClass("warning").html(t.statusText).show()}})},_callAjax:function(t,e,n){var r=this._animator;jQuery.ajax({url:n,type:"POST",async:!0,data:t,beforeSend:r.start(),complete:r.stop(),success:function(t){var n=jQuery.parseJSON(t);e(n)},error:function(){r.stop()}})},_removeError:function(){this._upl_errors.fadeOut().empty()},_delUpload:function(e){var n=this,r={id:e.attr("id")},i=function(e){e.status===!0?(t(".upl_info#upl_"+e.id).remove(),t(".upl_link#"+e.id).remove()):n._upl_errors.html(e.msg).addClass("warning").show()};this._callAjax(r,i,"php/router.php?controller=Media&action=delete")}})})(jQuery),$(document).ready(function(){$(document).on("mouseover",".upl_container",function(){$(this).DrpUploader()})});