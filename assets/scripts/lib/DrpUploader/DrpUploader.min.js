function AnimateBack(a){this.el=a;this.interval=0;this.gradient_percent=0;this.interval_value=5;this.time_interval=50;this.timer=null;this.anim=function(){if(this.interval===20){this.interval=0;this.gradient_percent=0}this.gradient_percent+=this.interval_value;this.el.css("background","linear-gradient(to right, rgba(64,64,64,1) "+this.gradient_percent+"%,rgba(0,0,0,0) 100%)");this.interval++};this.start=function(){if(this.timer===null){this.timer=setInterval((function(b){return function(){b.anim()}})(this),this.time_interval)}};this.stop=function(){var b=this;if(b.timer!==null){setTimeout(function(){clearInterval(b.timer);b.el.css("background-color","rgba(68,68,68,1)");b.timer=null},1000)}}}(function(a){a.widget("nmk.DrpUploader",{_drag_counter:0,_id:null,_controller:null,_upl_btn:null,_upl_errors:null,_upl_input:null,_animator:null,_upl_list:null,_create:function(){if(this.element.data("nmk.DrpUploader")!==undefined){return this}this._setElements();this._addEventHandlers()},_setElements:function(){this._upl_btn=this.element.find(".upl_btn");this._upl_input=this.element.find(".upl_input");this._upl_errors=this.element.find(".upl_errors");this._animator=new AnimateBack(this.element);this._id=this.element.attr("id");this._controller=this.element.data("controller");this._upl_list=this.element.find(".upl_filelist")},_addEventHandlers:function(){this._on(this.element,{dragenter:"_dragEnter",dragleave:"_dragLeave",dragover:"_dragOver",drop:"_getDrop",click:"_dispatch"});this._on(this._upl_btn,{click:"_onClick"});this._on(this.document.find(".del_upl"),{click:"_delUpload"});this._on(this._upl_input,{change:"_fireUpl"});this._on(this._upl_errors,{click:"_removeError"})},_dispatch:function(b){if(a(b.target).hasClass("del_upl")){this._delUpload(a(b.target))}},_fireUpl:function(f){f.preventDefault();var c=this._upl_input[0];for(var b=0;b<c.files.length;++b){var d=new FormData();d.append("file[]",c.files[b]);this._process(d)}},_dragEnter:function(b){b.stopPropagation();b.preventDefault();this._drag_counter++;this.element.addClass("dragging")},_dragLeave:function(b){b.stopPropagation();b.preventDefault();this._drag_counter--;if(this._drag_counter===0){this.element.removeClass("dragging")}},_dragOver:function(b){b.stopPropagation();b.preventDefault()},_getDrop:function(g){g.stopPropagation();g.preventDefault();var d=g.dataTransfer||(g.originalEvent&&g.originalEvent.dataTransfer);var c=g.target.files||(d&&d.files);if(c){for(var b=0;b<c.length;++b){var f=new FormData();f.append("file[]",c[b]);this._process(f)}}this.element.removeClass("dragging")},_onClick:function(){this._upl_input.click()},_process:function(c){var b=this;b._upl_errors.hide();jQuery.ajax({type:"POST",url:"php/upload.php?controller="+b._controller,headers:{"Cache-Control":"no-cache"},data:c,contentType:false,processData:false,beforeSend:b._animator.start(),complete:b._animator.stop(),async:true,success:function(e){var d=jQuery.parseJSON(e);var f=d.error;var g=a("form#"+b._id);if(f===true){if(g.length>0){g.append(d.input)}else{console.warn("No form linked to the uploader")}b._upl_list.append(d.file_div)}else{b._upl_errors.addClass("warning").html(f).show()}},error:function(d){b._animator.stop();b._upl_errors.addClass("warning").html(d.statusText).show()}})},_callAjax:function(d,e,b){b=(b===undefined)?"php/form.php":b;var c=this._animator;jQuery.ajax({url:b,type:"POST",async:true,data:d,beforeSend:c.start(),complete:c.stop(),success:function(g){var f=jQuery.parseJSON(g);e(f)},error:function(){c.stop()}})},_removeError:function(){this._upl_errors.fadeOut().empty()},_delUpload:function(c){var b=this;var d={del_upl:true,file_id:c.attr("id")};var e=function(f){if(f.status===true){a(".upl_info#upl_"+f.uplname).remove();a(".upl_link#"+f.uplname).remove()}else{b._upl_errors.html(f.msg).addClass("warning").show()}};console.log(d,b.element);this._callAjax(d,e)}})})(jQuery);$(document).ready(function(){$(document).on("mouseover",".upl_container",function(){$(this).DrpUploader()})});